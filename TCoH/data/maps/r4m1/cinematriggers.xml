<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>

	<trigger	Name="cinMolokovozFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			TActivate("cinMolokovoz_End")
			TActivate("cinMolokovoz_FadeIn")
			local veh=getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
			end
			Fly("molokovozExit", CINEMATIC_NO_AIM, nil, 10, 1,1)
			StartCinematic()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinMolokovoz_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			if GetPlayerVehicle() then
				GetPlayerVehicle():SetThrottle( 0 )
				GetPlayerVehicle():SetCustomLinearVelocity( 0 )
				GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("PlayerCar_loc")))
				GetPlayerVehicle():SetRotation(Quaternion(0.021, 0.994, -0.008, 0.106))
			end
			AddCinematicMessage( 10, 0.5 )
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn1_loc")), "AddWalkerHuman1")
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn2_loc")), "AddWalkerHuman2")
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn3_loc")), "AddWalkerHuman3")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinMolokovoz_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			trigger:Deactivate()
			local veh = getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
				veh:PlaceToEndOfPath("molokovozStartPath")
			end

			SaveWeaponGroups()
--			SetVar("PlayerCarName",GetPlayerVehicle():GetName())
			GetPlayerVehicle():setGodMode(true)
			CapturePlayerVehicle(0, "OilPlayer")

			local veh=getObj("PlayerMolokovoz")
			if veh then
	   		   g_Player:AddChild(veh)
			end
			TActivate("trOiler")
			TDeactivate("cinMolokovoz_FadeIn")
			TDeactivate("cinMolokovozFirst")
			SetCameraBehindPlayerVehicle()

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( false ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( false ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( false ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			RestoreAllToleranceStatus()
		</script>
	</trigger>


	<trigger	Name="cinPlCarReturnFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
--			println("AAA")
			SaveAllToleranceStatus(RS_NEUTRAL)
			TActivate("cinPlCarReturn_End")
			TActivate("cinPlCarReturn_FadeIn")
            TDeactivate("trTrailerDie")
--            LOG("A1")
--			local plcarname=GetVar("PlayerCarName").AsString
--            LOG("A2")
			local veh=getObj("OilPlayerCar")
			if veh then
--	            LOG("A3")
				veh:SetExternalPathByName("playerMolokPath")
				veh:SetCruisingSpeed(15)
			end
--            LOG("A4")
			Fly("molokovozExit", CINEMATIC_NO_AIM, nil, 11, 1,1)
			StartCinematic()
--            LOG("A5")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPlCarReturn_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
--            LOG("A6")
			if GetPlayerVehicle() then
				AddCinematicMessage( 11, 0.5 )
--	            LOG("A7")
				GetPlayerVehicle():SetThrottle( 0 )
				GetPlayerVehicle():SetCustomLinearVelocity( 0 )
				GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("MolokovozSpawn_loc")))
				GetPlayerVehicle():SetRotation(Quaternion(-0.047, -0.883, 0.025, 0.467))
--	            LOG("A8")
			end
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinPlCarReturn_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
--            LOG("A9")
--			local plcarname=GetVar("PlayerCarName").AsString
			local veh=getObj("OilPlayerCar")
--            LOG("A10")
			if veh then
--	            LOG("A11")
			    CapturePlayerVehicle(0, "MolokozPl")
	   		    g_Player:AddChild(veh)
	   		    RestoreWeaponGroups()
				veh:SetCustomControlEnabled(1)

				veh:SetExternalPathByName("playerMolokPath")
				veh:PlaceToEndOfPath("playerMolokPath")

				veh:setGodMode(false)
				veh:SetCustomControlEnabled(0)
--	            LOG("A12")
			end
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( true ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( true ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( true ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			TDeactivate("cinPlCarReturnFirst")
			TDeactivate("cinPlCarReturn_FadeIn")
--            LOG("A13")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineerFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			PlayCustomMusic("Passage04")
			ShowHostileVehicles(false)
			TActivate("cinEngineer_FadeIn")
			TActivate("cinEngineer_End")

			SetVar("PlTorque",GetPlayerVehicle():GetMaxTorque())
			SetVar("PlSpeed",GetPlayerVehicle():GetMaxSpeed())
			SetVar("PlCrSpeed",GetPlayerVehicle():GetCruisingSpeed())


            Fly("EngineerCamPath1", CINEMATIC_NO_AIM, nil, 7.3, 1,0)
			Fly("EngineerCamPath2", CINEMATIC_NO_AIM, nil, 7, 0,1)
			StartCinematic()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineer_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			if GetPlayerVehicle() then
				GetPlayerVehicle():SetGamePositionOnGround(CVector(4396.869, 300, 5880.139))
				GetPlayerVehicle():SetRotation(Quaternion(-0.018, -0.664, 0.004, 0.748))
--				GetPlayerVehicle():SetMaxTorque(400)
				GetPlayerVehicle():SetMaxSpeed(30)
				GetPlayerVehicle():SetCruisingSpeed(30)
				GetPlayerVehicle():SetForcedMaxTorque(350)
				GetPlayerVehicle():SetExternalPathByName("NearEngineerPlayerPath")
			end

			local enveh=CreateVehicleEx("Sml101","EngCar",CVector(4273.473, 300, 5923.936), 1060)
			if enveh then
				enveh:SetMaxTorque(150)
				enveh:SetMaxSpeed(70)
				enveh:SetCruisingSpeed(75)
				enveh:SetRotation(Quaternion(-0.002, -0.490, -0.011, 0.872))
				enveh:SetExternalPathByName("NearEngineerEngineerPath")
				enveh:setGodMode(1)
			end


			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinEngineer_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local enveh = getObj("EngCar")
			if enveh then 
--				println("AAAAAAAAAA")
				enveh:SetExternalPathByName("NearEngineerEngineerPath")
				enveh:PlaceToEndOfPath("NearEngineerEngineerPath")
				enveh:SetGamePositionOnGround(CVector(4114.627, 249.640, 6045.154))
				enveh:SetRotation(Quaternion(-0.008, 0.221, 0.002, 0.975))
				enveh:SetMaxTorque(100)
				enveh:SetMaxSpeed(80)
				enveh:SetCruisingSpeed(80)
			end

			local torq = GetVar("PlTorque").AsInt
			local speed = GetVar("PlSpeed").AsInt
			local crspeed = GetVar("PlCrSpeed").AsInt


			if GetPlayerVehicle() then
				GetPlayerVehicle():SetExternalPathByName("NearEngineerPlayerPath")
				GetPlayerVehicle():PlaceToEndOfPath("NearEngineerPlayerPath")
				GetPlayerVehicle():SetGamePositionOnGround(CVector(4097.918, 249.925, 6058.852))
				GetPlayerVehicle():SetRotation(Quaternion(-0.016, 0.831, 0.003, 0.555))
--				GetPlayerVehicle():SetMaxTorque(torq)
				GetPlayerVehicle():SetMaxSpeed(speed)
				GetPlayerVehicle():SetCruisingSpeed(crspeed)
				GetPlayerVehicle():ResetForcedMaxTorque()

			end
			PlayCustomMusic("Bio05")
			ShowHostileVehicles(true)
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()
			TDeactivate("cinEngineerFirst")
			TDeactivate("cinEngineer_FadeIn")
			StartConversation("r4m1_Engineer")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineerMustDieFirst"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			ShowHostileVehicles(false)
			TActivate("cinEngineerMustDie_End")
			local enveh=getObj("EngCar")
			if enveh then
				enveh:setGodMode( false )
				enveh:SetExternalPathByName("engineerWantDiePath")
				Fly("EngineerCamPath3", CINEMATIC_NO_AIM, nil, 6, 0,0)
				Fly("EngineerCamPath4", CINEMATIC_NO_AIM, nil, 3.5, 0,1)
				StartCinematic()
				AddCinematicMessage( 16, 0.5 )
				AddCinematicMessage( 17, 0.5 )
			end
			PlayCustomMusic("Passage05")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinEngineerMustDie_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		    ShowHostileVehicles(true)
			StopPlayingCustomMusic()
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhArmyFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>   
			SaveAllToleranceStatus(RS_NEUTRAL)
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			TActivate("cinBuhArmy_End")

			Fly("BuharsAttackPath", CINEMATIC_NO_AIM, nil, 8, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhArmy_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinBuhPortFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )
			GetPlayerVehicle():SetThrottle( 0 )

			SaveAllToleranceStatus(RS_NEUTRAL)
			TActivate("cinBuhPort_End")
			TActivate("cinBuhPort_FadeIn")
			PlayCustomMusic("QuietDialogue03")
			Fly("BuharsInPortPath", CINEMATIC_NO_AIM, nil, 18, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhPort_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buharers_vehicle_"..i)
				if buh then
					buh:SetMaxTorque(0)
					buh:SetMaxSpeed(0)
				end
			end
			   
			setPos("Buharers_vehicle_0", CVector(1355.880, 220.086, 3133.145))
			setRot("Buharers_vehicle_0", Quaternion(-0.008, 0.741, 0.008, 0.671))
			setPos("Buharers_vehicle_1", CVector(1354.502, 220.103, 3113.447))
			setRot("Buharers_vehicle_1", Quaternion(-0.010, 0.374, 0.004, 0.927))

			setPos(GetPlayerVehicle(), CVector(1387.320, 220.074, 3117.844))
			setRot(GetPlayerVehicle(), Quaternion(-0.009, -0.001, 0.000, 1.000))

			AddCinematicMessage( 12, 0.5 )
			AddCinematicMessage( 13, 0.5 )
			if QuestStatus("d_SinFather_Quest")==Q_COMPLETED then
				local oldLisa = getObj("CARLISA_R4M1_vehicle_0")
				if oldLisa then oldLisa:Remove() end

				local vehLisa = CreateVehicleEx("LisaCar", "LisaBuharers", CVector(1363.683, 220.556, 3105.291), 1042)
				if vehLisa then
					vehLisa:SetSkin(2)
					vehLisa:SetRotation(Quaternion(-0.000, 0.379, -0.000, 0.925))
				end

				AddHistory( "r4_LisaBecameCrazy" )
				AddCinematicMessage( 14, 0.5 )
			end

			AddCinematicMessage( 15, 0.5 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinBuhPort_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buharers_vehicle_"..i)
				if buh then
					buh:Remove()
				end
			end

			if QuestStatus("d_SinFather_Quest")==Q_COMPLETED then
				if getObj("CARLISA_R4M1_vehicle_0") then
					getObj("CARLISA_R4M1_vehicle_0"):Remove()
				end

				if getObj("LisaControllerR4M1") then
					getObj("LisaControllerR4M1"):Remove()
				end

				if getObj("LisaBuharers") then
					getObj("LisaBuharers"):Remove()
				end
			end

			CompleteQuestIfTaken("r3m2_FindInfoAboutFather")
			StopPlayingCustomMusic()
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinOilFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			TActivate("cinOil_End")
			TActivate("cinOil_FadeIn")
			TActivate("cinOil_StartFly")

			Fly("OilPath1", CINEMATIC_NO_AIM, nil, 6, 1,0)
			Fly("OilPath2", CINEMATIC_NO_AIM, nil, 4, 0,1)
			StartCinematic()

			PlayCustomMusic("Techno03")
            trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinOil_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("ZapravkaCar_loc")))
			GetPlayerVehicle():SetRotation(Quaternion(-0.005, -0.666, -0.005, 0.746))
			GetPlayerVehicle():SetExternalPathByName("ZapravkaIn")
			AddCinematicMessage( 3, 0.5 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinOil_StartFly" active="0">
		<event flypath="OilPath2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetExternalPathByName("ZapravkaOut")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinOil_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()
			GetPlayerVehicle():SetExternalPathByName("ZapravkaOut")
			GetPlayerVehicle():PlaceToEndOfPath("ZapravkaOut")
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()
			TActivate("trReturnPlCar")
			trigger:Deactivate()
		</script>
	</trigger>




	<trigger	Name="cinExit42ReturnFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			TActivate("cinExit42ReturnFirst")
			TActivate("cinExit42Return_FadeIn")
			TActivate("cinExit42Return_End")

			Fly("ExitTo42Return", CINEMATIC_NO_AIM, nil, 6, 1,1)
			StartCinematic()

			if QuestStatus("r4m1_RescueBuharsCivilian")~=Q_COMPLETED then
				AddCinematicMessage( 8802, 0.5 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit42Return_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(7469.020, 274.164, 3698.224))
			GetPlayerVehicle():SetRotation(Quaternion(0.019, -0.761, 0.027, 0.648))
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR4M2")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinExit42Return_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR4M2")
			GetPlayerVehicle():PlaceToEndOfPath("ReturnPathR4M2")
			SetCameraBehindPlayerVehicle()
			trigger:Deactivate()
		</script>
	</trigger>




	<trigger	Name="cinExit42OkFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			TDeactivate("trExitToR4M2")
			TActivate("cinExit42OkFirst")
			TActivate("cinExit42Ok_FadeIn")
			TActivate("cinExit42Ok_End")

			Fly("ExitTo42Ok", CINEMATIC_NO_AIM, nil, 4, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit42Ok_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(7455.524, 272.676, 3692.821))
			GetPlayerVehicle():SetRotation(Quaternion(-0.047, 0.655, 0.020, 0.754))
			GetPlayerVehicle():SetExternalPathByName("ExitTo42Ok")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit42Ok_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			TActivate("trExitToR4M2")
			PassToMap("r4m2", "FromR4M1", 0 , true)
			trigger:Deactivate()
		</script>
	</trigger>



	<trigger	Name="cinExit11ReturnFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			TActivate("cinExit11ReturnFirst")
			TActivate("cinExit11Return_FadeIn")
			TActivate("cinExit11Return_End")

			Fly("ExitTo11Return", CINEMATIC_NO_AIM, nil, 4, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit11Return_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(3113.161, 274.148, 7483.117))
			GetPlayerVehicle():SetRotation(Quaternion(0.011, 0.919, -0.008, 0.393))
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR1M1")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinExit11Return_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			GetPlayerVehicle():SetExternalPathByName("ReturnPathR1M1")
			GetPlayerVehicle():PlaceToEndOfPath("ReturnPathR1M1")
			SetCameraBehindPlayerVehicle()
			trigger:Deactivate()
		</script>
	</trigger>




	<trigger	Name="cinExit11OkFirst"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			TDeactivate("trExitToR4M0")
			TActivate("cinExit11OkFirst")
			TActivate("cinExit11Ok_FadeIn")
			TActivate("cinExit11Ok_End")

			Fly("ExitTo11Ok", CINEMATIC_NO_AIM, nil, 4, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinExit11Ok_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetGamePositionOnGround(CVector(3099.917, 274.184, 7495.875))
			GetPlayerVehicle():SetRotation(Quaternion(0.002, -0.290, -0.042, 0.956))
			GetPlayerVehicle():SetExternalPathByName("ExitTo11Ok")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinExit11Ok_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			DisableGodMode()
			TActivate("trExitToR4M0")
			PassToMap("r4m0", "FromR4M1", 0 , true)
			trigger:Deactivate()
		</script>
	</trigger>


	<!-- ����� ������� ��������� �� ����� -->
	<trigger	Name="cinPriezdFirst"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			EnableGodMode()
			SaveAllToleranceStatus(RS_NEUTRAL)

			if QuestStatus("d_SinFather_Quest")==Q_COMPLETED then
				Fly("FirstPriezd", CINEMATIC_NO_AIM, nil, 23, 1,1)
			else
				Fly("FirstPriezd", CINEMATIC_NO_AIM, nil, 16, 1,1)
			end
			StartCinematic()
			UpdateCinematic( 1 )
			TActivate("cinPriezd_FadeIn")
			TActivate("cinPriezd_End")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinPriezd_FadeIn"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>

			GetPlayerVehicle():SetGamePositionOnGround(CVector(3129.591, 273.090, 7477.917))
			GetPlayerVehicle():SetRotation(Quaternion(0.032, 0.925, -0.002, 0.378))
			GetPlayerVehicle():SetExternalPathByName("PriezdToR4M1")
			if QuestStatus("d_SinFather_Quest")==Q_COMPLETED then
				GetPlayerVehicle():LimitMaxSpeed(5.2)
				AddCinematicMessage( 1, 0.25 )
				AddCinematicMessage( 18, 0.25 )
				AddCinematicMessage( 19, 0.25 )
			else
				GetPlayerVehicle():LimitMaxSpeed(7)
				AddCinematicMessage( 1, 0.25 )
				AddCinematicMessage( 2, 0.25 )
			end
			
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinPriezd_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			GetPlayerVehicle():SetExternalPathByName("PriezdToR4M1")
			GetPlayerVehicle():PlaceToEndOfPath("PriezdToR4M1")
			GetPlayerVehicle():UnlimitMaxSpeed()

			RestoreAllToleranceStatus()

			DisableGodMode()

			SetCameraBehindPlayerVehicle()

			if QuestStatus("d_SinFather_Quest")==Q_COMPLETED then
				local oldLisa = getObj("CARLISA_vehicle_0")
				if oldLisa then oldLisa:Remove() end

				local cont = getObj("LisaControllerR3M1")
				if cont then cont:Remove() end

				TeamCreate("ENEMYLISA", 1042, CVector(3301.896, 267.899, 7348.589), {"LisaCar"}, nil, nil, Quaternion(-0.000, -0.290, -0.011, 0.957))
				local vehLisa = getObj("ENEMYLISA_vehicle_0")
				if vehLisa then
					vehLisa:SetSkin(2)
					vehLisa:setImmortalMode(1)
					TActivate("trENEMYLISA_DEAD")
					TDeactivate("trExitToR4M0")
					SetTolerance(1100, 1042, RS_ENEMY)
				else
					LOG("ERROR! EnemyLisa does not exists!")
				end
			else
				TakeQuest("r4m1_FindNative")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- ������� ����, ����� ��� ������ ������������� -->
	<trigger Name="trENEMYLISA_DEAD" active="0">
		<event eventid="GE_VEHICLE_WITHOUT_HEALTH" ObjName="ENEMYLISA_vehicle_0" />
		<event	timeout="60"		eventid="GE_TIME_PERIOD" />
		<script>

			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("IntenseDialogue02")

			local vehLisa = CreateVehicleEx("LisaCar", "LisaDefeated", CVector(0, 2000, 0), 1042)
			local vehLisaId = vehLisa:GetId()

			FlyLinked("ENEMYLISADEAD_cam01", GetPlayerVehicleId(), 43.5, 1, 1, vehLisaId)
			StartCinematic()

			TActivate("Rolik_ENEMYLISADEAD_Fade")
			TActivate("Rolik_ENEMYLISADEAD_Msg22")
			TActivate("Rolik_ENEMYLISADEAD_End")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Rolik_ENEMYLISADEAD_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround(CVector(3313.987, 267.814, 7311.647))
				vehPlayer:SetRotation(Quaternion(-0.010, -0.987, 0.002, -0.160))
			end

			local oldLisa = getObj("ENEMYLISA_vehicle_0")
			if oldLisa then oldLisa:Remove() end

			local vehLisa = GetEntityByName("LisaDefeated")
			if vehLisa then
				vehLisa:SetCustomLinearVelocity(0)
				vehLisa:SetThrottle(0)
				vehLisa:SetSkin(2)
				vehLisa:SetGamePositionOnGround(CVector(3323.063, 267.737, 7283.302))
				vehLisa:SetRotation(Quaternion(0.003, 0.142, 0.003, -0.990))
			end

			AddCinematicMessage(20, 2)
			AddCinematicMessage(21, 0.25)
			AddCinematicMessage(22, 0.25)
			AddCinematicMessage(2, 0.25)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Rolik_ENEMYLISADEAD_Msg22" active="0">
		<event msgid="22" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Rolik_ENEMYLISADEAD_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			StopPlayingCustomMusic()

			local oldLisa = getObj("ENEMYLISA_vehicle_0")
			if oldLisa then oldLisa:Remove() end

			local oldLisa = getObj("LisaDefeated")
			if oldLisa then oldLisa:Remove() end

			TeamCreate("CARLISA_R4M1", 1042, CVector(3323.063, 267.737, 7283.302), {"LisaCar"}, nil, nil, Quaternion(0.003, 0.142, 0.003, -0.990))
			local vehLisa = getObj("CARLISA_R4M1_vehicle_0")
			if vehLisa then
				vehLisa:SetSkin(2)
				vehLisa:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "LisaControllerR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehLisa)
				end
			else
				LOG("ERROR! Lisa\'s car does not exists!")
			end

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
			end

			TakeQuest("r4m1_FindNative")

			SetTolerance(1100, 1042, RS_ALLY)

			TDeactivate("Rolik_ENEMYLISADEAD_Fade")
			TDeactivate("Rolik_ENEMYLISADEAD_Msg22")
			TActivate("trExitToR4M0")

			trigger:Deactivate()
		</script>
	</trigger>

	<!-- �������� �� �������� � ����� -->

	<trigger Name="cinMovePlToR2M2_begin" active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
			
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			EnableGodMode()
			
			Fly("lodka1", CINEMATIC_NO_AIM, 0, 21, 1, 0 )
			Fly("lodka2", CINEMATIC_NO_AIM, 0, 15, 0, 1 )
			StartCinematic()
			
			PlayCustomMusic("Bio02")
			
			TActivate("cinMovePlToR2M2_Fade")
			TActivate("cinMovePlToR2M2_cam03")
			TActivate("cinMovePlToR2M2_End")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			
			CreateNewDummyObject( "submarina",	"SubmR4M1", -1, -1, CVector(318.837, 150.000, 3490.127), Quaternion(0.0000, 0.8204, 0.0000, 0.5718), 0 )
			
			local moverId = CreateNewObject { prototypeName	= "cinematicMover", objName  = "" }
			local mover = GetEntityByID( moverId ) 
			local controlledObj = GetEntityByName("SubmR4M1")
			if controlledObj then
				mover:SetObjAndPath( controlledObj:GetId(), "lodka3", 20 )
			end
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetPosition( CVector(1262.583, 214.190, 3151.562))
		   		vehPlayer:SetRotation(Quaternion(-0.005, 0.557, -0.006, -0.830))
		   	end
		   	
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_cam03" active="0">
		<event flypath="lodka2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local podlodka = getObj("SubmR4M1")
			if podlodka then
				podlodka:SetNodeAction(AT_STAND2)
			end

			TActivate("subzaezd11")
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="subzaezd11" active="0">
		<event	timeout="7"		eventid="GE_TIME_PERIOD" />
		<script>
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("subzaezd1")
				vehPlayer:LimitMaxSpeed( 20 )
		   	end
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinMovePlToR2M2_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			
			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetExternalPathByName("subzaezd1")
				vehPlayer:PlaceToEndOfPath()
				vehPlayer:SetCustomLinearVelocity(0)
				vehPlayer:UnlimitMaxSpeed()
		   	end
			
			StopPlayingCustomMusic()
			
			DisableGodMode()
			
			TActivate("trSubDelete")
			
			TDeactivate("subzaezd11")
			TDeactivate("cinMovePlToR2M2_cam03")
			
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()
						
			PassToMap("r2m2", "FromR4M1", -1 , true)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: Game start  -->

	<trigger	Name="HamzaStartRolikBegin"	active="0">
		<event	timeout="0.001"			eventid="GE_TIME_PERIOD" />
		<script>
			StartMoney()

			local mancar = CreateVehicleEx("UralMansur","MansurCar",CVector(2061.603, 239.088, 3658.598), 1090)
			if mancar then
				mancar:SetExternalPathByName("MansurStartGame_1")
				mancar:SetCruisingSpeed(12.6)
				mancar:SetSkin(1)
			end

			local Plf = GetPlayerVehicle()
            local PlfID = GetPlayerVehicleId()

			Plf:SetRandomSkin()

			CreateFirstAttackersCS()

			local BezVeh3 = GetEntityByName("FrstAttacker2")
			local BezID = BezVeh3:GetId()

            Fly("startgameHamza_cam1", CINEMATIC_AIM_TO_ID, PlfID, 15, 0, 0 )
			Fly("startgameHamza_cam2", CINEMATIC_AIM_TO_ID, PlfID, 6, 0, 0 )
			Fly("startgameHamza_cam3", CINEMATIC_AIM_TO_ID, PlfID, 13.5, 0, 0 )
			Fly("startgameHamza_bez", CINEMATIC_NO_AIM, 0, 7, 0, 0 )
			Fly("stgameHamza_final", CINEMATIC_AIM_TO_ID, BezID, 4, 0, 1 )

            StartCinematic()

			local PCar = GetPlayerVehicle()
			if PCar then
			    PCar:LimitMaxSpeed(13.4)
				PCar:SetCustomControlEnabled( true ) 
			    PCar:SetExternalPathByName("XamzaStartGame_1")
				PCar:SetThrottle( 1 )    
				PCar:SetCustomControlEnabled( false )
			end

			local PSkin = GetPlayerVehicle():GetSkin()
			SetVar("PlayerMilkSkin", tonumber(PSkin))

			AddCinematicMessage(40, 2)
			AddCinematicMessage(41, 0.5)

			TActivate("HamzaStartGameRolik_Music")
			TActivate("HamzaStartGameRolik_2")
			TActivate("HamzaStartGameRolik_4")
			TActivate("HamzaStartGameRolik_3")
			TActivate("HamzaStartGameRolik_End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HamzaStartGameRolik_Music"	active="0">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			PlayCustomMusic("Bio05")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HamzaStartGameRolik_2" active="0">
		<event flypath="startgameHamza_cam2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage(42, 0.5)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HamzaStartGameRolik_4" active="0">
		<event flypath="startgameHamza_cam3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
            RuleConsole("cinematic_spring_coeff 0.4")

			AddCinematicMessage(43, 0.5)
			AddCinematicMessage(44, 0.5)

			trigger:Deactivate()
		</script>
	</trigger>

    <trigger Name="HamzaStartGameRolik_3" active="0">
		<event flypath="startgameHamza_bez" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			PlayCustomMusic("Passage03b")

			local PCar = GetPlayerVehicle()
			if PCar then
			    PCar:LimitMaxSpeed(40)
				PCar:setGodMode(1)
			end

			local MCar = GetEntityByName("MansurCar")
			if MCar then
			    MCar:SetCruisingSpeed(40)
				MCar:setGodMode(1)
			end

			AddCinematicMessage(45, 0.5)

			SetVar("StartBattle", 0)

			TActivate("HamzaStartGameRolik_Attack")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HamzaStartGameRolik_Attack"	active="0">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			local vehAttacker0 = GetEntityByName("FrstAttacker0")
			local vehAttacker1 = GetEntityByName("FrstAttacker1")
			local vehAttacker2 = GetEntityByName("FrstAttacker2")
			local vehAttacker3 = GetEntityByName("FrstAttacker3")

			local vehP = GetPlayerVehicle()
			local vehPID = GetPlayerVehicleId()

			local vehM = GetEntityByName("MansurCar")

			if vehAttacker0 and vehPID then
				vehAttacker0:SetCustomControlEnabled(1)
				vehAttacker0:SetCustomControlWeapons(2)
				vehAttacker0:SetCustomControlWeaponsTargetObj(vehPID)
				vehAttacker0:FireFromWeaponCustom2(1, vehPID)
			end

			if vehAttacker1 and vehM then
				vehAttacker1:SetCustomControlEnabled(1)
				vehAttacker1:SetCustomControlWeapons(2)
				vehAttacker1:SetCustomControlWeaponsTargetObj(vehM:GetId())
				vehAttacker1:FireFromWeaponCustom2(1, vehM:GetId())
			end

			if vehAttacker2 and vehPID then
				vehAttacker2:SetCustomControlEnabled(1)
				vehAttacker2:SetCustomControlWeapons(2)
				vehAttacker2:SetCustomControlWeaponsTargetObj(vehPID)
				vehAttacker2:FireFromWeaponCustom2(1, vehPID)
			end

			if vehAttacker3 and vehM then
				vehAttacker3:SetCustomControlEnabled(1)
				vehAttacker3:SetCustomControlWeapons(2)
				vehAttacker3:SetCustomControlWeaponsTargetObj(vehM:GetId())
				vehAttacker3:FireFromWeaponCustom2(1, vehM:GetId())
			end
		</script>
	</trigger>

	<trigger Name="HamzaStartGameRolik_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		local ManCar = GetEntityByName("MansurCar")
		    if ManCar then
		        ManCar:PlaceToEndOfPath("MansurStartGame_1")
			end

		local PCar = GetPlayerVehicle()
			if PCar then
				PCar:UnlimitMaxSpeed()
				PCar:PlaceToEndOfPath("XamzaStartGame_1")
				PCar:setGodMode(0)
			end

		local mCar = getObj("MansurCar")
			if mCar then
			    mCar:Remove()
		    end

		CreateTeam("MansurTachka",1090,CVector(2485.159, 272.206, 3927.403),{"UralMansur"})

		local mfCar = GetEntityByName("MansurTachka_vehicle_0")
		    if mfCar then
		        mfCar:SetSkin(1)
		end

		TDeactivate("HamzaStartGameRolik_Attack")

		CreateFirstAttackers()

		TActivate("FirstDebyli_Die")
		TActivate("MansurCar_Die")

		if (GetVar("StartBattle").AsInt==1) then
			PlayCustomMusic("Passage03b")
		end

		RestoreAllToleranceStatus()

		SetCameraBehindPlayerVehicle()

		trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: After Mad Battle -->

	<trigger Name="AfterBezumBoiRolik_Start" active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
            PlayCustomMusic("IntenseDialogue03")

			SaveAllToleranceStatus(RS_NEUTRAL)

			RuleConsole("cinematic_spring_coeff 0.3")

			local mfEndCar = GetEntityByName("MansurTachka_vehicle_0")
			    if mfEndCar then
				mfEndCar:Remove()
			end

			CreateVehicleEx("UralMansur","MansurCar",CVector(2529.488, 266.557, 3914.102), 1090)

			local mancar = GetEntityByName("MansurCar")
			if mancar then
		        mancar:SetGamePositionOnGround( CVector(2512.508, 271.686, 3950.259))
				mancar:SetRotation(Quaternion(-0.039, -0.131, -0.021, 0.990))
			    mancar:SetSkin(1) 
			end

			local PCar = GetPlayerVehicle()
			if PCar then
			    PCar:SetGamePositionOnGround( CVector(2568.719, 271.686, 3976.013))
				PCar:SetRotation(Quaternion(0.058, 0.118, 0.024, -0.991))
				PCar:SetCustomControlEnabled( true )
				PCar:SetCustomLinearVelocity( 0 )
				PCar:SetThrottle( 0 )
				PCar:SetCustomControlEnabled( false )
			end

            local Plf = GetPlayerVehicle()
            local PlfID = GetPlayerVehicleId()

			local MCar = GetEntityByName("MansurCar")
			local MCarID = MCar:GetId()

            FlyLinked( "afterbattleHamza_cam1", nil, 110, 1, 0, PlfID ) 
			FlyLinked( "afterbattleHamza_cam3", nil, 37, 0, 0, PlfID )
			FlyLinked( "afterbattleHamza_cam4", nil, 6, 0, 1, MCarID )  

			StartCinematic()

			TActivate("AfterBezumBoiRolik_quietdialogue")
			TActivate("AfterBezumBoiRolik_cam03")

            TActivate("AfterBezumBoiRolik_Fade")
			TActivate("AfterBezumBoiRolik_End")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterBezumBoiRolik_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
		    CinemaFiltersUse()

		    local mancar = GetEntityByName("MansurCar")
			if mancar then
				mancar:SetCruisingSpeed(11.5)
				mancar:SetExternalPathByName("MansurStartGame_2")
				mancar:SetThrottle( 1 )
				mancar:SetCustomLinearVelocity( 20 ) 
			end

			local PCar = GetPlayerVehicle()
			if PCar then
				PCar:LimitMaxSpeed(11.5)
				PCar:SetCustomControlEnabled( true ) 
				PCar:SetExternalPathByName("HamzarStartGame_2")
				PCar:SetThrottle( 1 )                      
				PCar:SetCustomLinearVelocity( 10 )    
				PCar:SetCustomControlEnabled( false )
			end

			AddCinematicMessage(46, 0.5)
			AddCinematicMessage(47, 0.5)
			AddCinematicMessage(48, 0.5)
			AddCinematicMessage(49, 0.5)
			AddCinematicMessage(50, 0.5)
			AddCinematicMessage(51, 0.5)
			AddCinematicMessage(52, 0.5)
			AddCinematicMessage(53, 0.5)
			AddCinematicMessage(54, 0.5)
			AddCinematicMessage(55, 0.5)
			AddCinematicMessage(56, 0.5)
			AddCinematicMessage(57, 0.5)
			AddCinematicMessage(58, 0.5)
			AddCinematicMessage(59, 0.5)

			TActivate("AfterBezumBoiRolik_quietdialogue")
			TActivate("AfterBezumBoiRolik_cam03")
            
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterBezumBoiRolik_quietdialogue" active="0">
		<event msgid="55" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			PlayCustomMusic("QuietDialogue02")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterBezumBoiRolik_cam03" active="0">
		<event flypath="afterbattleHamza_cam3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage(60, 0.5)
			AddCinematicMessage(61, 0.5)
			AddCinematicMessage(62, 0.5)
			AddCinematicMessage(63, 0.5)
			AddCinematicMessage(64, 0.5)
			AddCinematicMessage(65, 0.5)

			TActivate("AfterBezumBoiRolik_cam04")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterBezumBoiRolik_cam04" active="0">
		<event flypath="afterbattleHamza_cam4" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local mancar2 = GetEntityByName("MansurCar")
			if mancar2 then
				mancar2:SetCruisingSpeed(40)
				mancar2:SetExternalPathByName("MansurStartGame_3")
				mancar2:SetThrottle( 1 )
				mancar2:SetCustomLinearVelocity( 20 ) 
			end

			AddCinematicMessage(66, 0.5)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterBezumBoiRolik_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		local MCrem = getObj("MansurCar")
			if MCrem then
			    MCrem:Remove()
		    end

		local PCar = GetPlayerVehicle()
			if PCar then
				PCar:UnlimitMaxSpeed()
				PCar:PlaceToEndOfPath("HamzarStartGame_2")
			end

		TakeQuest("BackToHome_quest")

		AddBook("r4_survivorarchive")

		AddHistory( "tcoh_firststory" )
		AddFadingMsgId( "fm_history_got" )
		AddImportantFadingMsgByStrIdFormatted("fm_history_got")

		TActivate("CreateDadCar")

		RestoreAllToleranceStatus()

		SetCameraBehindPlayerVehicle()

		StopPlayingCustomMusic()

        trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: After Race -->

	<trigger Name="AfterRaceRolik_begin" active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
        PlayCustomMusic("QuietDialogue01")

		SaveAllToleranceStatus(RS_NEUTRAL)

		local Plf = GetPlayerVehicle()
        local PlfID = GetPlayerVehicleId()

		Fly("AfterRaceRolik_cam01", CINEMATIC_AIM_TO_ID, PlfID, 21, 1, 0 )
		Fly("AfterRaceRolik_cam02", CINEMATIC_AIM_TO_ID, PlfID, 13, 0, 1 )

		StartCinematic()

		TActivate("AfterRaceRolik_cam02")
		TActivate("AfterRaceRolik_End")
		
		if QuestStatus("GonkaUral")==Q_COMPLETED then
			AddCinematicMessage( 75, 0.25 )
			AddCinematicMessage( 76, 0.25 )
			AddCinematicMessage( 77, 0.25 )
		elseif QuestStatus("GonkaUralSpec")==Q_COMPLETED then
			local WinNumber = GetVar("WinningNumber").AsInt
			if WinNumber == 3 then
				AddCinematicMessage( 752, 0.25 )
				AddCinematicMessage( 762, 0.25 )
				AddCinematicMessage( 772, 0.25 )
			else
				AddCinematicMessage( 753, 0.25 )
				AddCinematicMessage( 763, 0.25 )
				AddCinematicMessage( 773, 0.25 )
			end
		end

		AddCinematicMessage( 78, 0.25 )
		AddCinematicMessage( 79, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterRaceRolik_cam02" active="0">
		<event flypath="AfterRaceRolik_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
        PlayCustomMusic("Passage05")

		AddCinematicMessage( 80, 0.25 )
		AddCinematicMessage( 81, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterRaceRolik_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
    	RestoreAllToleranceStatus()

		SetCameraBehindPlayerVehicle()

		StopPlayingCustomMusic()

		local MCar = getObj("MansurCar")
		if MCar then
		    MCar:Remove()
		end

		local town1 = GetEntityByName("TheKef")
		if town1 then town1:SetOpenGateToPlayer( true ) end

		local town2 = GetEntityByName("TheGadad")
		if town2 then town2:SetOpenGateToPlayer( true ) end

		local town3 = GetEntityByName("TheKazif")
		if town3 then town3:SetOpenGateToPlayer( true ) end

		local a = GetEntityByName("StartGonka_loc")
		if a then a:SetProperty("Active", 1) end

		SetVar("MaxLap", 2)
		SetVar("CountCar", 8)

		TActivate("Kef_Sell_Add")
		TActivate("Gadad_Sell_Add")
		TActivate("Kazif_Sell_Add")
		TActivate("all_sale_added_fading")

		TActivate("ConnectMansur_AfterRace")
		TActivate("GadadForDefendrolik_start")
		TakeQuest("DefendGadad_quest")

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="all_sale_added_fading" active="0">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
		AddFadingMsgId( "fm_all_sale_added" )
		AddImportantFadingMsgByStrIdFormatted( "fm_all_sale_added" )

        trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: Gadad Defend -->

	<trigger Name="GadadForDefendrolik_start" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="GadadDefendQuest_loc" />
		<script>
        PlayCustomMusic("Battle01")

		SaveAllToleranceStatus(RS_NEUTRAL)

		local PVeh = GetPlayerVehicle()
		if PVeh then
			PVeh:SetThrottle( 0 )
			PVeh:SetCustomLinearVelocity( 0 )
			PVeh:SetGamePositionOnGround( CVector(5459.207, 251.206, 6512.162))
			PVeh:SetRotation(Quaternion(0.002, 0.146, 0.003, 0.989))
			PVeh:SetExternalPathByName("GadadDefend_path")
			PVeh:LimitMaxSpeed(25)
		end

		local vehMansur = getObj("MansurCarAR_vehicle_0")
		if vehMansur then
			vehMansur:SetGamePositionOnGround( CVector(5462.912, 250.988, 6480.071))
			vehMansur:SetRotation(Quaternion(0.001, -0.134, 0.011, -0.991))
		end

		CreateGadadAttackers()
		CreateHarakatDefenders()
		CreateAlfaranDefenders()

		Fly("GadadDefend_cam01", CINEMATIC_NO_AIM, 0, 11, 1, 1 )

		StartCinematic()

		TActivate("ArrivedToGadadForDefend_Fade")
		TActivate("ArrivedToGadadForDefend_End")

		AddCinematicMessage( 82, 0.25 )
		AddCinematicMessage( 83, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ArrivedToGadadForDefend_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			SetTolerance(1091, 1062, RS_ENEMY)
			SetTolerance(1092, 1062, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
            
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ArrivedToGadadForDefend_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		RestoreAllToleranceStatus()

        SetTolerance(1100, 1062, RS_ENEMY)
		SetTolerance(1100, 1090, RS_ALLY)
		SetTolerance(1100, 1091, RS_ALLY)
		SetTolerance(1100, 1092, RS_ALLY)
		SetTolerance(1091, 1090, RS_ALLY)
		SetTolerance(1092, 1090, RS_ALLY)
		SetTolerance(1091, 1092, RS_ALLY)

		local PVeh = GetPlayerVehicle()
		if PVeh then
			PVeh:PlaceToEndOfPath("GadadDefend_path")
			PVeh:UnlimitMaxSpeed()
		end

		local town1 = GetEntityByName("TheKef")
		if town1 then town1:SetOpenGateToPlayer( false ) end

		local town2 = GetEntityByName("TheGadad")
		if town2 then town2:SetOpenGateToPlayer( false ) end

		local town3 = GetEntityByName("TheKazif")
		if town3 then town3:SetOpenGateToPlayer( false ) end

		local a = GetEntityByName("StartGonka_loc")
		if a then a:SetProperty("Active",0) end
        
        SetCameraBehindPlayerVehicle()

		TActivate("AfterGadadDefendRolik_Start")
		TActivate("MansurCar_DieOnGadadDefend")

        trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: After Gadad Defend -->

	<trigger Name="AfterGadadDefendRolik_Start" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="GadadDebyli" />
		<script>
		PlayCustomMusic("Bio02")

		SaveAllToleranceStatus(RS_NEUTRAL)

		local Plf = GetPlayerVehicle()
        local PlfID = GetPlayerVehicleId()

		local PVeh = GetPlayerVehicle()
		if PVeh then
		    PVeh:SetGamePositionOnGround( CVector(5791.517, 251.013, 7154.484))
			PVeh:SetRotation(Quaternion(-0.001, 0.569, -0.004, -0.822))
			PVeh:SetThrottle( 0 )
			PVeh:SetCustomLinearVelocity( 0 )
		end

		local MVeh = getObj("MansurCarAR_vehicle_0")
		if MVeh then
		    MVeh:Remove()
		end

		local Defs = getObj("GadadDefenders")
		if Defs then
		    Defs:Remove()
		end

		local AlfaDefs = getObj("GadadAlfaDefenders")
		if AlfaDefs then
		    AlfaDefs:Remove()
		end

		local MVehSt = CreateVehicleEx("UralMansur","MansurCar1",CVector(5764.546, 251.021, 7144.929), 1090)
		if MVehSt then
		    MVehSt:SetSkin(1)
			MVehSt:SetRotation(Quaternion(0.004, 0.850, -0.001, 0.526))
		end

		local DzhaVeh = CreateVehicleEx("BelazShot","DzhamilCar",CVector(5764.849, 250.992, 7174.349), 1091)
		if DzhaVeh then
		    DzhaVeh:SetSkin(1)
			DzhaVeh:SetRotation(Quaternion(0.001, 0.884, -0.005, -0.467))
		end

		Fly("AfterGadadDefend_cam01", CINEMATIC_NO_AIM, 0, 43, 1, 0 )
		Fly("AfterGadadDefend_cam02", CINEMATIC_NO_AIM, 0, 41, 0, 0 )
		Fly("AfterGadadDefend_cam03", CINEMATIC_AIM_TO_ID, PlfID, 34, 0, 1 )

		StartCinematic()

		TActivate("AfterGadadDefendRolik_cam02")
		TActivate("AfterGadadDefendRolik_cam03")
		TActivate("AfterGadadDefendRolik_End")

		AddCinematicMessage( 84, 0.25 )
		AddCinematicMessage( 85, 0.25 )
		AddCinematicMessage( 86, 0.25 )
		AddCinematicMessage( 87, 0.25 )
		AddCinematicMessage( 88, 0.25 )
		AddCinematicMessage( 89, 0.25 )
		AddCinematicMessage( 90, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterGadadDefendRolik_cam02" active="0">
		<event flypath="AfterGadadDefend_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
        PlayCustomMusic("Death01")

		AddCinematicMessage( 91, 0.25 )
		AddCinematicMessage( 92, 0.25 )
		AddCinematicMessage( 93, 0.25 )
		AddCinematicMessage( 94, 0.25 )
		AddCinematicMessage( 95, 0.25 )
		AddCinematicMessage( 96, 0.25 )
		AddCinematicMessage( 97, 0.25 )
		AddCinematicMessage( 98, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterGadadDefendRolik_cam03" active="0">
		<event flypath="AfterGadadDefend_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
        PlayCustomMusic("IntenseDialogue01")

		AddCinematicMessage( 99, 0.25 )
		AddCinematicMessage( 100, 0.25 )
		AddCinematicMessage( 101, 0.25 )
		AddCinematicMessage( 102, 0.25 )
		AddCinematicMessage( 103, 0.25 )
		AddCinematicMessage( 104, 0.25 )
		AddCinematicMessage( 105, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AfterGadadDefendRolik_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		RestoreAllToleranceStatus()

		local MVeh = getObj("MansurCar1")
		if MVeh then
		    MVeh:Remove()
		end

		local DzhaCar = getObj("DzhamilCar")
		if DzhaCar then
		    DzhaCar:Remove()
		end

		local town1 = GetEntityByName("TheKef")
		if town1 then town1:SetOpenGateToPlayer( true ) end

		local town2 = GetEntityByName("TheGadad")
		if town2 then town2:SetOpenGateToPlayer( true ) end

		local town3 = GetEntityByName("TheKazif")
		if town3 then town3:SetOpenGateToPlayer( true ) end

		local a = GetEntityByName("StartGonka_loc")
		if a then a:SetProperty("Active",1) end

        CompleteQuest("DefendGadad_quest")
		TakeQuest("TalkToMansur_quest")

		AddHistory( "tcoh_firststory" )
		AddFadingMsgId( "fm_history_got" )
		AddImportantFadingMsgByStrIdFormatted("fm_history_got")

		StopPlayingCustomMusic()
        
        SetCameraBehindPlayerVehicle()

        trigger:Deactivate()
		</script>
	</trigger>

	<!-- The Chronicle of Hamza: Mansur sees the bandit -->

	<trigger Name="MansurSeeRob_start" active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
		SaveAllToleranceStatus(RS_NEUTRAL)

		local PVeh = GetPlayerVehicle()
		if PVeh then
			PVeh:SetThrottle( 0 )
			PVeh:SetCustomLinearVelocity( 8 )
			PVeh:SetGamePositionOnGround( CVector(5760.192, 251.149, 4867.326))
			PVeh:SetRotation(Quaternion(0.000, 0.962, -0.002, -0.273))
		end

		local RobVeh = CreateVehicleEx("UralShot1","RobCar",CVector(5621.561, 251.949, 4983.046), 1024)
		if RobVeh then
		    RobVeh:SetRotation(Quaternion(0.011, 0.968, 0.004, 0.250))
			RobVeh:SetExternalPathByName("Rob_Path")
			RobVeh:SetCruisingSpeed(15)
		end

		local RVeh = GetEntityByName("RobCar")
		local RobVehID = RVeh:GetId()

		local Plf = GetPlayerVehicle()
        local PlfID = GetPlayerVehicleId()

		Fly("MansurSeeRob_cam01", CINEMATIC_AIM_TO_ID, RobVehID, 6, 1, 0 )
		Fly("MansurSeeRob_cam02", CINEMATIC_AIM_TO_ID, RobVehID, 7, 0, 0 )
		Fly("MansurSeeRob_cam03", CINEMATIC_AIM_TO_ID, RobVehID, 11, 0, 0 )
		Fly("MansurSeeRob_cam04", CINEMATIC_AIM_TO_ID, PlfID, 34, 0, 1 )

		StartCinematic()

        TActivate("MansurSeeRob_Fade")
        TActivate("MansurSeeRob_cam02")
		TActivate("MansurSeeRob_cam03")
		TActivate("MansurSeeRob_cam04")
		TActivate("MansurSeeRob_End")

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_Fade" active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			PlayCustomMusic("Techno03")

			AddCinematicMessage( 106, 0.25 )
            
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_cam02" active="0">
		<event flypath="MansurSeeRob_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		AddCinematicMessage( 107, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_cam03" active="0">
		<event flypath="MansurSeeRob_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
		RuleConsole("cinematic_spring_coeff 1")

		local PVeh = GetPlayerVehicle()
		if PVeh then
		    PVeh:SetExternalPathByName("RobSpy_Path")
		    PVeh:LimitMaxSpeed(15)
		end

		AddCinematicMessage( 108, 0.25 )
		AddCinematicMessage( 109, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_cam04" active="0">
		<event flypath="MansurSeeRob_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>

		AddCinematicMessage( 110, 0.25 )
		AddCinematicMessage( 111, 0.25 )
		AddCinematicMessage( 112, 0.25 )
		AddCinematicMessage( 113, 0.25 )
		AddCinematicMessage( 114, 0.25 )

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
		RestoreAllToleranceStatus()

		local RobVehR = getObj("RobCar")
		if RobVehR then
		    RobVehR:Remove()
		end

		CreateTeam("KillTheRob",1024,CVector(5787.375, 251.980, 4690.306),{"UralShot1"},CVector(5787.375, 251.980, 4690.306), nil)
		
		local RobVehA = getObj("KillTheRob_vehicle_0")
		if RobVehA then
		    RobVehA:SetRotation(Quaternion(0.006, 0.968, -0.001, 0.250))
		end

		local PVeh = GetPlayerVehicle()
		if PVeh then
		    PVeh:UnlimitMaxSpeed()
			PVeh:SetExternalPathByName("RobSpy_Path")
			PVeh:PlaceToEndOfPath("RobSpy_Path")
		end

		CompleteQuest("KillTheRob_quest")
		TakeQuest("KillTheRobfinal_quest")

		TActivate("TheThiefHasBeenKilled")

		StopPlayingCustomMusic()      
        SetCameraBehindPlayerVehicle()

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinHamzaOilQuest"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("cinHamzaOilQuest_End")
			TActivate("cinHamzaOilQuest_FadeIn")

			local veh=getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
			end

			Fly("molokovozExit", CINEMATIC_NO_AIM, nil, 7, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="cinHamzaOilQuest_FadeIn"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			if GetPlayerVehicle() then
				GetPlayerVehicle():SetThrottle( 0 )
				GetPlayerVehicle():SetCustomLinearVelocity( 0 )
				GetPlayerVehicle():SetGamePositionOnGround(CVector(getPos("PlayerCar_loc")))
				GetPlayerVehicle():SetRotation(Quaternion(0.021, 0.994, -0.008, 0.106))
			end
			AddCinematicMessage( 116, 0.5 )
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn1_loc")), "AddWalkerHuman1")
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn2_loc")), "AddWalkerHuman2")
			CreateHuman( "Human", 1001, CVector(getPos("AddHumanSpawn3_loc")), "AddWalkerHuman3")
			TActivate("ConnectMansuronHamzasCar")
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="cinHamzaOilQuest_End"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			trigger:Deactivate()
			local veh = getObj("PlayerMolokovoz")
			if veh then
				veh:SetExternalPathByName("molokovozStartPath")
				veh:PlaceToEndOfPath("molokovozStartPath")
			end

			SaveWeaponGroups()
			GetPlayerVehicle():setGodMode(true)
			CapturePlayerVehicle(0, "OilPlayer")

			local veh=getObj("PlayerMolokovoz")
			if veh then
	   		   g_Player:AddChild(veh)
			end

			local explayercar = getObj("OilHamzaCar")
			if explayercar then
				explayercar:setGodMode(1)
			end

			TActivate("trHamzaOiler")
			TDeactivate("cinHamzaOilQuest_FadeIn")
			TDeactivate("cinHamzaOilQuest")
			SetCameraBehindPlayerVehicle()

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( false ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( false ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( false ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			RestoreAllToleranceStatus()
		</script>
	</trigger>

	<trigger	Name="HamzaReachOil_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)
			
			local PCar = GetPlayerVehicle()
			if PCar then
				PCar:SetThrottle( 0 )
				PCar:SetCustomLinearVelocity( 0 )
			end

			local PCarID = GetPlayerVehicleId()

			TActivate("HamzaReachOil_cs_fade")
			TActivate("HamzaReachOil_cs_fly")
			TActivate("HamzaReachOil_cs_end")

			Fly("OilPath1", CINEMATIC_AIM_TO_ID, PCarID, 6.5, 1, 0)
			Fly("OilPath2", CINEMATIC_AIM_TO_ID, PCarID, 4, 0, 1)
			StartCinematic()

			PlayCustomMusic("Techno03")
            trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HamzaReachOil_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local PCar = GetPlayerVehicle()
			if PCar then
				PCar:SetGamePositionOnGround(CVector(getPos("ZapravkaCar_loc")))
				PCar:SetRotation(Quaternion(-0.005, -0.666, -0.005, 0.746))
				PCar:SetExternalPathByName("ZapravkaIn")
			end

			AddCinematicMessage( 118, 0.5 )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="HamzaReachOil_cs_fly" active="0">
		<event flypath="OilPath2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local PCar = GetPlayerVehicle()
			if PCar then
				PCar:SetExternalPathByName("ZapravkaOut")
			end

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="HamzaReachOil_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			StopPlayingCustomMusic()

			local PCar = GetPlayerVehicle()
			if PCar then
				PCar:SetExternalPathByName("ZapravkaOut")
				PCar:PlaceToEndOfPath("ZapravkaOut")
			end

			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			TActivate("HamzaReturnCar")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceStart_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local FVeh1 = GetEntityByName("FormulaCar1")
			local FVeh1ID = FVeh1:GetId()

			local FVeh2 = GetEntityByName("FormulaCar2")
			local FVeh2ID = FVeh2:GetId()

			local FVeh3 = GetEntityByName("FormulaCar3")
			local FVeh3ID = FVeh3:GetId()

			local Plf = GetPlayerVehicle()
        	local PlfID = GetPlayerVehicleId()
			
			Fly("RaceStart_cam01", CINEMATIC_AIM_TO_ID, FVeh1ID, 3, 1, 0 )
			Fly("RaceStart_cam02", CINEMATIC_AIM_TO_ID, FVeh2ID, 3, 0, 0 )
			Fly("RaceStart_cam03", CINEMATIC_AIM_TO_ID, FVeh3ID, 3, 0, 0 )
			Fly("RaceStart_cam04", CINEMATIC_AIM_TO_ID, PlfID, 3, 0, 1 )
			StartCinematic()

			PlayCustomMusic("RaceQuest")

			TActivate("RaceStart_cs_fade")
			TActivate("RaceStart_cs_cam02")
			TActivate("RaceStart_cs_cam03")
			TActivate("RaceStart_cs_cam04")
			TActivate("RaceStart_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceStart_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			AddCinematicMessage( 117, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStart_cs_cam02" active="0">
		<event flypath="RaceStart_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 1171, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStart_cs_cam03" active="0">
		<event flypath="RaceStart_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 1172, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStart_cs_cam04" active="0">
		<event flypath="RaceStart_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 1173, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceStart_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			TActivate("trRaceTimer1")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HamzaReturnCar_cs_start"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("HamzaReturnCar_cs_end")
			TActivate("HamzaReturnCar_cs_fade")
            TDeactivate("trTrailerDie")

			local veh=getObj("OilHamzaCar")
			if veh then
				veh:SetExternalPathByName("playerMolokPath")
				veh:SetCruisingSpeed(15)
			end

			Fly("molokovozExit", CINEMATIC_NO_AIM, nil, 11, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="HamzaReturnCar_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetThrottle( 0 )
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetGamePositionOnGround(CVector(getPos("MolokovozSpawn_loc")))
				Plf:SetRotation(Quaternion(-0.047, -0.883, 0.025, 0.467))
			end

			AddCinematicMessage( 119, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="HamzaReturnCar_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			local veh=getObj("OilHamzaCar")
			if veh then
			    CapturePlayerVehicle(0, "MolokozPl")
	   		    g_Player:AddChild(veh)
	   		    RestoreWeaponGroups()
				veh:SetCustomControlEnabled(1)

				veh:SetExternalPathByName("playerMolokPath")
				veh:PlaceToEndOfPath("playerMolokPath")

				veh:setGodMode(false)
				veh:SetCustomControlEnabled(0)
			end

			local vehmol=getObj("PlayerMolokovoz")
			if vehmol then
	   		   vehmol:Remove()
			end

			local vehMansur = getObj("MansurHamzaCar_vehicle_0")
			if vehMansur then
				vehMansur:Remove()
			end

			local contMansur = getObj("MansurControllerR4M1")
			if contMansur then
				contMansur:Remove()
			end

			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			CompleteQuest("TakeOilKef_BackToKef_quest")
			TakeQuest("TakeOilKef_TalkWithMario_quest")

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( true ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( true ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( true ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			TDeactivate("HamzaReturnCar_cs_start")
			TDeactivate("HamzaReturnCar_cs_fade")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="MansurSpeakWithParents_cs"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="TheGadad_enter" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("Techno01")

			CreateMansurAndParents()

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround( CVector(5425.003, 251.144, 6988.131))
				PVeh:SetRotation(Quaternion(0.008, -0.467, 0.001, -0.884))
				PVeh:SetThrottle( 0 )
				PVeh:SetCustomLinearVelocity( 0 )
			end

			Fly("mswp_cam", CINEMATIC_NO_AIM, nil, 138, 1, 0)
			Fly("mswp_cam01", CINEMATIC_NO_AIM, nil, 43, 0, 1)
			StartCinematic()

			TActivate("MansurSpeakWithParents_cs_fade")
			TActivate("MansurSpeakWithParents_cs_cam01")
			TActivate("MansurSpeakWithParents_cs_msg124")
			TActivate("MansurSpeakWithParents_cs_msg131")
			TActivate("MansurSpeakWithParents_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="MansurSpeakWithParents_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			AddCinematicMessage( 120, 0.5 )
			AddCinematicMessage( 121, 0.2 )
			AddCinematicMessage( 122, 0.2 )
			AddCinematicMessage( 123, 0.2 )
			AddCinematicMessage( 124, 0.2 )
			AddCinematicMessage( 125, 0.2 )
			AddCinematicMessage( 126, 0.2 )
			AddCinematicMessage( 127, 0.2 )
			AddCinematicMessage( 128, 0.2 )
			AddCinematicMessage( 129, 0.2 )
			AddCinematicMessage( 130, 0.2 )
			AddCinematicMessage( 131, 0.2 )
			AddCinematicMessage( 132, 0.2 )
			AddCinematicMessage( 133, 0.2 )
			AddCinematicMessage( 134, 0.2 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSpeakWithParents_cs_cam01" active="0">
		<event flypath="mswp_cam01" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 135, 0.2 )
			AddCinematicMessage( 136, 0.2 )
			AddCinematicMessage( 137, 0.2 )
			AddCinematicMessage( 138, 0.2 )
			AddCinematicMessage( 139, 0.2 )
			AddCinematicMessage( 140, 0.2 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSpeakWithParents_cs_msg124" active="0">
		<event msgid="124" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			PlayCustomMusic("IntenseDialogue01")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSpeakWithParents_cs_msg131" active="0">
		<event msgid="131" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			PlayCustomMusic("QuietDialogue01")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="MansurSpeakWithParents_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			SetCameraBehindPlayerVehicle()

			StopPlayingCustomMusic()

			local Parents = getObj("ParentsCar")
			if Parents then
				Parents:Remove()
			end

			local Mansur = getObj("MansurCar")
			if Mansur then
				Mansur:Remove()
			end

			AddHistory("tcoh_aftermswp")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			TActivate("ConnectMansur_GoToBuhara_Again")
			TActivate("FirstMeetAivanJr_SaveThem_cs")

			CompleteQuest("GoToMansurParents_quest")
			TakeQuest("GoToBuharaAgain_quest")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="FirstMeetAivanJr_SaveThem_cs"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FirstMeetAivanJr_SaveThem_loc" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			PlayCustomMusic("Battle01")

			CreateBuharaAndAivanJrAttackers()
			CreateBuharaAndAivanJr()

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(getPos("HamzaPos_SaveBhrnJr_loc")))
				PVeh:SetRotation(Quaternion(-0.015, -0.844, 0.014, 0.536))
				PVeh:SetExternalPathByName("HamzaGoToSaveBuhara")
				PVeh:SetThrottle( 0 )
				PVeh:SetCustomLinearVelocity( 0 )
			end

			local vehMansur = getObj("MansurCarSB_vehicle_0")
			if vehMansur then
				vehMansur:SetGamePositionOnGround(CVector(getPos("MansurPos_SaveBhrnJr_loc")))
				vehMansur:SetRotation(Quaternion(-0.015, -0.844, 0.014, 0.536))
			end

			local buhara0god = getObj("Buharers_vehicle_0")
			if buhara0god then
				buhara0god:setGodMode(1)
			end

			local buhara1god = getObj("Buharers_vehicle_1")
			if buhara1god then
				buhara1god:setGodMode(1)
			end

			local aivanjrgod = getObj("AivanJr_vehicle_0")
			if aivanjrgod then
				aivanjrgod:setGodMode(1)
			end

			for i=0,3 do
				local vehA = getObj("BuharaAttack_vehicle_"..i)
				if vehA then
					vehA:setGodMode(1)
				end
			end

			SetTolerance(1100,1025, RS_ENEMY)
			SetTolerance(1026,1025, RS_ENEMY)
			SetTolerance(1090,1025, RS_ENEMY)
			SetTolerance(1095,1025, RS_ENEMY)

			Fly("savejrandbuhara_cam", CINEMATIC_NO_AIM, nil, 10, 1, 1)
			StartCinematic()

			TActivate("FirstMeetAivanJr_SaveThem_cs_fade")
			TActivate("FirstMeetAivanJr_SaveThem_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="FirstMeetAivanJr_SaveThem_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			AddCinematicMessage(141, 0.25)
			AddCinematicMessage(142, 0.25)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="FirstMeetAivanJr_SaveThem_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			SetCameraBehindPlayerVehicle()

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetExternalPathByName("HamzaGoToSaveBuhara")
				PVeh:PlaceToEndOfPath("HamzaGoToSaveBuhara")
				PVeh:SetGamePositionOnGround( CVector(1895.075, 229.861, 6603.666))
				PVeh:SetRotation(Quaternion(-0.015, -0.844, 0.014, 0.536))
			end

			local vehMansur = getObj("MansurCarSB_vehicle_0")
			if vehMansur then
				vehMansur:SetGamePositionOnGround( CVector(1854.443, 231.509, 6617.965))
				vehMansur:SetRotation(Quaternion(-0.038, -0.794, 0.041, 0.605))
			end

			local buhara0god = getObj("Buharers_vehicle_0")
			if buhara0god then
				buhara0god:setGodMode(0)
			end

			local buhara1god = getObj("Buharers_vehicle_1")
			if buhara1god then
				buhara1god:setGodMode(0)
			end

			local aivanjrgod = getObj("AivanJr_vehicle_0")
			if aivanjrgod then
				aivanjrgod:setGodMode(0)
			end

			for i=0,3 do
				local vehA = getObj("BuharaAttack_vehicle_"..i)
				if vehA then
					vehA:setGodMode(0)
				end
			end

			AutoSave()

			TActivate("AivanJrDies")
			TActivate("OneOfBuharaDies")
			TActivate("MansurDiesOnBuharaAndJrDefend")
			TActivate("AttackersDies")
			TActivate("PlayerDiesOnBuharaAndJrDefend")
			TActivate("SetTolerance_BuharaSave")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BuharaEvacuated_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetCustomLinearVelocity( 0 )
				PVeh:SetThrottle( 0 )
			end

			SaveAllToleranceStatus(RS_NEUTRAL)

			TActivate("BuharaEvacuated_cs_fade")
			TActivate("BuharaEvacuated_cs_end")

			PlayCustomMusic("QuietDialogue03")

			Fly("buharaevacuated_cam", CINEMATIC_NO_AIM, nil, 56, 1,1)
			StartCinematic()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BuharaEvacuated_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buhara_"..i)
				if buh then
					buh:SetMaxTorque(0)
					buh:SetMaxSpeed(0)
				end
			end

			local veh1 = getObj("Buhara_0")
			if veh1 then
				veh1:SetGamePositionOnGround(CVector(1460.511, 220.437, 3150.398))
				veh1:SetRotation(Quaternion(0.015, 0.872, 0.002, 0.489))
			end

			local veh2 = getObj("Buhara_1")
			if veh2 then
				veh2:SetGamePositionOnGround(CVector(getPos("BuharaEvacuated_cs_Buhara1_loc")))
				veh2:SetRotation(Quaternion(0.010, 0.880, 0.003, 0.475))
			end

			local PlVeh = GetPlayerVehicle()
			if PlVeh then
				PlVeh:SetGamePositionOnGround(CVector(getPos("BuharaEvacuated_cs_Player_loc")))
				PlVeh:SetRotation(Quaternion(0.017, -0.297, 0.018, 0.954))
			end

			local MCarCR = getObj("MansurControllerBuharaR4M1")
			if MCarCR then
				MCarCR:Remove()
			end

			local ACarCR = getObj("AivenControllerBuharaR4M1")
			if ACarCR then
				ACarCR:Remove()
			end

			local MCarR = getObj("MansurCarSB_vehicle_0")
			if MCarR then
				MCarR:Remove()
			end

			local ACarR = getObj("AivenCarSB_vehicle_0")
			if ACarR then
				ACarR:Remove()
			end

			local ManCarCreate = CreateVehicleEx("UralMansur", "MansurCarCS", CVector(getPos("BuharaEvacuated_cs_Mansur_loc")), 1090)
			if ManCarCreate then
				ManCarCreate:SetRotation(Quaternion(0.023, -0.814, -0.019, 0.580))
				ManCarCreate:SetSkin(1)
			end

			local AivenCreate = CreateVehicleEx("BelazShot1", "AivenCarCS", CVector(getPos("BuharaEvacuated_cs_AivenJr_loc")), 1095)
			if AivenCreate then
				AivenCreate:SetRotation(Quaternion(-0.006, 0.922, 0.008, -0.387))
				AivenCreate:SetSkin(3)
			end
			
			AddCinematicMessage( 143, 0.5 )
			AddCinematicMessage( 144, 0.5 )
			AddCinematicMessage( 145, 0.5 )
			AddCinematicMessage( 146, 0.5 )
			AddCinematicMessage( 147, 0.5 )
			AddCinematicMessage( 148, 0.5 )
			AddCinematicMessage( 149, 0.5 )
			AddCinematicMessage( 150, 0.5 )
			AddCinematicMessage( 151, 0.5 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BuharaEvacuated_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			for i=0,1 do
				local buh = getObj("Buhara_"..i)
				if buh then
					buh:Remove()
				end
			end

			local MCarR = getObj("MansurCarCS")
			if MCarR then
				MCarR:Remove()
			end

			local ACarR = getObj("AivenCarCS")
			if ACarR then
				ACarR:Remove()
			end

			TActivate("ConnectAivan_GoToZarmek")
			TActivate("ConnectMansur_GoToZarmek")

			CompleteQuest("EvacuateBuharas_quest")
			TakeQuest("GoToZarmek_quest")

			AddHistory("tcoh_buharaevacuated")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			StopPlayingCustomMusic()
			SetCameraBehindPlayerVehicle()
			RestoreAllToleranceStatus()

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active", 1) end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceStartSpec_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(3648.640, 263.625, 1836.151))
				PVeh:SetRotation(Quaternion(0.003, 1.000, -0.001, 0.029))
			end

			RaceCutsceneCams()

			PlayCustomMusic("RaceQuest")

			SetVar("CarCurSide1","2")
			SetVar("CarCurSide2","1")
			SetVar("CarCurSide3","3")
			SetVar("CarCurSide4","2")

			if getObj("MansurControllerR4M1") then
		        getObj("MansurControllerR4M1"):Remove()
		    end

		    local ManVehicle = getObj("MansurCar_vehicle_0")
			if ManVehicle then
			    ManVehicle:Remove()
			end

			TActivate("RaceStartSpec_cs_fade")
			TActivate("RaceStartSpec_cs_cam01")
			TActivate("RaceStartSpec_cs_cam02")
			TActivate("RaceStartSpec_cs_cam03")
			TActivate("RaceStartSpec_cs_cam04")
			TActivate("RaceStartSpec_cs_camStart")
			TActivate("RaceSpec_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceStartSpec_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			AddCinematicMessage( 117, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStartSpec_cs_cam02" active="0">
		<event flypath="RaceStart_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local winnum = GetVar("WinningNumber").AsInt
			if winnum == 1 then
				AddCinematicMessage( 1172, 0.25 )
			elseif winnum == 2 then
				AddCinematicMessage( 1172, 0.25 )
			elseif winnum == 3 then
				AddCinematicMessage( 1171, 0.25 )
			elseif winnum == 4 then
				AddCinematicMessage( 1172, 0.25 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStartSpec_cs_cam01" active="0">
		<event flypath="RaceStart_cam01" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local winnum = GetVar("WinningNumber").AsInt
			if winnum == 1 then
				AddCinematicMessage( 1171, 0.25 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStartSpec_cs_cam03" active="0">
		<event flypath="RaceStart_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local winnum = GetVar("WinningNumber").AsInt
			if winnum == 1 then
				AddCinematicMessage( 1173, 0.25 )
			elseif winnum == 2 then
				AddCinematicMessage( 1173, 0.25 )
			elseif winnum == 3 then
				AddCinematicMessage( 1173, 0.25 )
			elseif winnum == 4 then
				AddCinematicMessage( 1171, 0.25 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStartSpec_cs_cam04" active="0">
		<event flypath="RaceStart_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local winnum = GetVar("WinningNumber").AsInt
			if winnum == 2 then
				AddCinematicMessage( 1171, 0.25 )
			elseif winnum == 3 then
				AddCinematicMessage( 1172, 0.25 )
			elseif winnum == 4 then
				AddCinematicMessage( 1173, 0.25 )
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceStartSpec_cs_camStart" active="0">
		<event flypath="RaceSpec_cam01" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			TActivate("RaceSpecStart")

			AddCinematicMessage( 1174, 0.2 )

			TActivate("RaceSpec_cam02tr")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceSpec_cam02tr" active="0">
		<event flypath="RaceSpec_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local maxcar = GetVar("CountCar").AsInt
			local winnum = GetVar("WinningNumber").AsInt
			
			local myArray = {1,2,3,4}
			table.remove(myArray, winnum)

			for i=1,3 do
  				local side = {"M","R","LAST"}
  				local veh1=getObj("Formula"..myArray[i])
  				if veh1 then
					local let = {"L","M","R"}
					local nump = GetVar("CarCurSide"..i).AsInt
					veh1:PlaceToEndOfPath("Gonka_StartPath_"..let[nump])
    				veh1:SetGamePositionOnGround(getPos("RaceSpec_4"..side[i].."_loc"))
					veh1:SetRotation(Quaternion(0.000, -0.998, 0.009, 0.057))
  				end
			end

			local vehWiener = getObj("Formula"..winnum)
			if vehWiener then
				local let = {"L","M","R"}
				local nump = GetVar("CarCurSide3").AsInt
				vehWiener:PlaceToEndOfPath("Gonka_StartPath_"..let[nump])
  				vehWiener:SetGamePositionOnGround(getPos("RaceSpec_4L_loc"))
				vehWiener:SetRotation(Quaternion(0.000, -0.998, 0.009, 0.057))
			end

			local FVeh1 = getObj("Formula1_1")
			if FVeh1 then
				FVeh1:SetExternalPathByName("Gonka_Spec_1_L")
				FVeh1:SetCustomLinearVelocity(45)
			end

			local FVeh2 = getObj("Formula2_1")
			if FVeh2 then
				FVeh2:SetExternalPathByName("Gonka_Spec_1_M")
				FVeh2:SetCustomLinearVelocity(40)
			end

			local FVeh3 = getObj("Formula3_1")
			if FVeh3 then
				FVeh3:SetExternalPathByName("Gonka_Spec_1_R")
				FVeh3:SetCustomLinearVelocity(50)
			end

			local FVeh4 = getObj("Formula4_1")
			if FVeh4 then
				FVeh4:SetExternalPathByName("Gonka_Spec_1_M")
				FVeh4:SetCustomLinearVelocity(48)
			end

			TActivate("RaceSpec_cam03tr")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceSpec_cam03tr" active="0">
		<event flypath="RaceSpec_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local skin0 = GetVar("FormulaSkin0").AsInt
			local skin1 = GetVar("FormulaSkin1").AsInt
			local skin2 = GetVar("FormulaSkin2").AsInt
			local skin3 = GetVar("FormulaSkin3").AsInt

			for i=1,4 do
			    local veh1=getObj("Formula"..i.."_1")
			    if veh1 then
					veh1:Remove()
			    end
			end

			local FVeh1 = CreateVehicleEx("UralRace00", "Formula1_2", CVector(3375.157, 298.695, 2280.094), 1100)
			if FVeh1 then
				FVeh1:SetCustomLinearVelocity(95)
				FVeh1:SetExternalPathByName("GonkaSpec_1_2_R")
				FVeh1:SetRotation(Quaternion(-0.012, 0.057, 0.010, 0.998))
				FVeh1:SetForcedMaxTorque(800)
				FVeh1:SetMaxSpeed(100)
				FVeh1:SetCruisingSpeed(100)
				FVeh1:SetSkin(skin0)
			end

			local FVeh2 = CreateVehicleEx("UralRace01", "Formula2_2", CVector(3365.223, 298.775, 2286.419), 1100)
			if FVeh2 then
				FVeh2:SetCustomLinearVelocity(90)
				FVeh2:SetExternalPathByName("GonkaSpec_1_2_M")
				FVeh2:SetRotation(Quaternion(-0.012, 0.057, 0.010, 0.998))
				FVeh2:SetForcedMaxTorque(800)
				FVeh2:SetMaxSpeed(100.4)
				FVeh2:SetCruisingSpeed(65)
				FVeh2:SetSkin(skin1)
			end

			local FVeh3 = CreateVehicleEx("UralMansurRace", "Formula3_2", CVector(3366.088, 298.401, 2273.316), 1100)
			if FVeh3 then
				FVeh3:SetCustomLinearVelocity(87)
				FVeh3:SetExternalPathByName("GonkaSpec_1_2_L")
				FVeh3:SetRotation(Quaternion(-0.012, 0.057, 0.010, 0.998))
				FVeh3:SetForcedMaxTorque(800)
				FVeh3:SetMaxSpeed(100.4)
				FVeh3:SetCruisingSpeed(65)
				FVeh3:SetSkin(skin2)
			end

			local FVeh4 = CreateVehicleEx("UralRace00", "Formula4_2", CVector(3351.098, 298.031, 2261.550), 1100)
			if FVeh4 then
				FVeh4:SetCustomLinearVelocity(86)
				FVeh4:SetExternalPathByName("GonkaSpec_1_2_4")
				FVeh4:SetRotation(Quaternion(-0.012, 0.057, 0.010, 0.998))
				FVeh4:SetForcedMaxTorque(800)
				FVeh4:SetMaxSpeed(100.4)
				FVeh4:SetCruisingSpeed(65)
				FVeh4:SetSkin(skin3)
			end

			TActivate("RaceSpec_cam04tr")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceSpec_cam04tr" active="0">
		<event flypath="RaceSpec_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local skin0 = GetVar("FormulaSkin0").AsInt
			local skin1 = GetVar("FormulaSkin1").AsInt
			local skin2 = GetVar("FormulaSkin2").AsInt
			local skin3 = GetVar("FormulaSkin3").AsInt

			for i=1,4 do
			    local veh1=getObj("Formula"..i.."_2")
			    if veh1 then
					veh1:Remove()
			    end
			end

			local FVeh1 = CreateVehicleEx("UralRace00", "Formula1_3", CVector(getPos("RaceSpec_2L_loc")), 1100)
			if FVeh1 then
				FVeh1:SetExternalPathByName("Gonka_Spec_2_L")
				FVeh1:SetRotation(Quaternion(0.005, 0.706, -0.001, 0.708))
				FVeh1:SetCustomLinearVelocity(53)
				FVeh1:SetForcedMaxTorque(800)
				FVeh1:SetMaxSpeed(100)
				FVeh1:SetCruisingSpeed(100)
				FVeh1:SetSkin(skin0)
			end

			local FVeh2 = CreateVehicleEx("UralRace01", "Formula2_3", CVector(getPos("RaceSpec_2R_loc")), 1100)
			if FVeh2 then
				FVeh2:SetExternalPathByName("Gonka_Spec_2_R")
				FVeh2:SetRotation(Quaternion(0.005, 0.706, -0.001, 0.708))
				FVeh2:SetCustomLinearVelocity(61)
				FVeh2:SetForcedMaxTorque(800)
				FVeh2:SetMaxSpeed(100.4)
				FVeh2:SetCruisingSpeed(65)
				FVeh2:SetSkin(skin1)
			end

			local FVeh3 = CreateVehicleEx("UralMansurRace", "Formula3_3", CVector(getPos("RaceSpec_2M_loc"))+CVector(0,1,0), 1100)
			if FVeh3 then
				FVeh3:SetForcedMaxTorque(800)
				FVeh3:SetExternalPathByName("Gonka_Spec_2_M")
				FVeh3:SetRotation(Quaternion(0.005, 0.706, -0.001, 0.708))
				FVeh3:SetCustomLinearVelocity(64)
				FVeh3:SetMaxSpeed(100.4)
				FVeh3:SetCruisingSpeed(65)
				FVeh3:SetSkin(skin2)
			end

			local FVeh4 = CreateVehicleEx("UralRace00", "Formula4_3", CVector(getPos("RaceSpec_2_4_loc")), 1100)
			if FVeh4 then
				FVeh4:SetExternalPathByName("Gonka_Spec_2_M")
				FVeh4:SetRotation(Quaternion(0.005, 0.706, -0.001, 0.708))
				FVeh4:SetCustomLinearVelocity(57)
				FVeh4:SetForcedMaxTorque(800)
				FVeh4:SetMaxSpeed(100.4)
				FVeh4:SetCruisingSpeed(65)
				FVeh4:SetSkin(skin3)
			end

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(3439.506, 262.658, 3105.028))
			end

			TActivate("RaceSpec_cam05tr")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceSpec_cam05tr" active="0">
		<event flypath="RaceSpec_cam05" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local skin0 = GetVar("FormulaSkin0").AsInt
			local skin1 = GetVar("FormulaSkin1").AsInt
			local skin2 = GetVar("FormulaSkin2").AsInt
			local skin3 = GetVar("FormulaSkin3").AsInt

			for i=1,4 do
			    local veh1=getObj("Formula"..i.."_3")
			    if veh1 then
					veh1:Remove()
			    end
			end

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(3768.964, 302.745, 2723.464))
				PVeh:SetRotation(Quaternion(0.003, 0.905, 0.071, 0.420))
			end

			local FVeh1 = CreateVehicleEx("UralRace00", "Formula1_4", CVector(getPos("RaceSpec_3R_loc"))+CVector(0,1,0), 1100)
			if FVeh1 then
				FVeh1:SetExternalPathByName("Gonka_Spec_3_R")
				FVeh1:SetRotation(Quaternion(0.003, 0.994, -0.003, -0.105))
				FVeh1:SetCustomLinearVelocity(63)
				FVeh1:SetForcedMaxTorque(800)
				FVeh1:SetMaxSpeed(97)
				FVeh1:SetCruisingSpeed(97)
				FVeh1:SetSkin(skin0)
			end

			local FVeh2 = CreateVehicleEx("UralRace01", "Formula2_4", CVector(getPos("RaceSpec_3M_loc"))+CVector(0,1,0), 1100)
			if FVeh2 then
				FVeh2:SetExternalPathByName("Gonka_Spec_3_M")
				FVeh2:SetRotation(Quaternion(0.003, 0.994, -0.003, -0.105))
				FVeh2:SetCustomLinearVelocity(55)
				FVeh2:SetForcedMaxTorque(800)
				FVeh2:SetMaxSpeed(87)
				FVeh2:SetCruisingSpeed(87)
				FVeh2:SetSkin(skin1)
			end

			local FVeh3 = CreateVehicleEx("UralMansurRace", "Formula3_4", CVector(getPos("RaceSpec_3L_loc"))+CVector(0,1,0), 1100)
			if FVeh3 then
				FVeh3:SetForcedMaxTorque(800)
				FVeh3:SetExternalPathByName("Gonka_Spec_3_L")
				FVeh3:SetRotation(Quaternion(0.003, 0.994, -0.003, -0.105))
				FVeh3:SetCustomLinearVelocity(60)
				FVeh3:SetMaxSpeed(88)
				FVeh3:SetCruisingSpeed(88)
				FVeh3:SetSkin(skin2)
			end

			local FVeh4 = CreateVehicleEx("UralRace00", "Formula4_4", CVector(getPos("RaceSpec_3_4_loc"))+CVector(0,1,0), 1100)
			if FVeh4 then
				FVeh4:SetExternalPathByName("Gonka_Spec_3_L")
				FVeh4:SetRotation(Quaternion(0.003, 0.994, -0.003, -0.105))
				FVeh4:SetCustomLinearVelocity(52)
				FVeh4:SetForcedMaxTorque(800)
				FVeh4:SetMaxSpeed(76)
				FVeh4:SetCruisingSpeed(76)
				FVeh4:SetSkin(skin3)
			end

			TActivate("RaceSpec_cam06tr")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RaceSpec_cam06tr" active="0">
		<event flypath="RaceSpec_cam06" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			for i=1,4 do
			    local veh1=getObj("Formula"..i.."_4")
			    if veh1 then
					veh1:Remove()
			    end
			end

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(4030.250, 280.113, 2165.785))
				PVeh:SetRotation(Quaternion(0.005, -0.998, -0.000, 0.056))
			end

			local myArray = {1,2,3,4}
			local winnum = GetVar("WinningNumber").AsInt
			table.remove(myArray, winnum)

			for i=1,3 do
  				local side = {"LAST","M","R"}
				local speed = {"43", "37", "49"}
  				local veh1=getObj("Formula"..myArray[i])
  				if veh1 then
    				veh1:SetExternalPathByName("Gonka_Spec_4_0_"..side[i])
					veh1:SetCustomLinearVelocity(speed[i])
  				end
			end

			local vehWiener = getObj("Formula"..winnum)
			if vehWiener then
  				vehWiener:SetExternalPathByName("Gonka_Spec_4_0_L")
				vehWiener:SetCustomLinearVelocity(59)
			end

			TActivate("CinematicMSGWinner")
			TActivate("RaceSpec_FinishPaths")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CinematicMSGWinner" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint1_loc" />
		<script>
        	local winnum = GetVar("WinningNumber").AsInt

			AddCinematicMessage(7770+winnum, 0.2)

        	trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RaceSpec_FinishPaths"	active="0">
	<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint1_loc" />
		<script>
			local amount = trigger:GetTriggeredObjectAmount()
			local car = {}

			for i=0,amount do
			car[i] = GetEntityByID(trigger:GetTriggeredObjectID(i))
				if car[i] then
					car[i]:SetCruisingSpeed(GetVar("EndRaceSpeed").AsInt)
					SetVar("EndRaceSpeed", GetVar("EndRaceSpeed").AsInt-1)
				end
			end
		</script>
	</trigger>

	<trigger	Name="RaceSpec_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			StopPlayingCustomMusic()

			TActivate("BettingCheck")

			TDeactivate("RaceSpec_FinishPaths")
			TActivate("AfterRaceRolik_begin")

			local ManCar = CreateVehicleEx("UralMansur","MansurCar",CVector(4615.387, 280.066, 2194.772), 1090)
			if ManCar then
			    ManCar:SetRotation(Quaternion(0.000, 0.993, 0.001, -0.118))
				ManCar:SetSkin(1)
			end

			local PlCar = GetPlayerVehicle() 
			if PlCar then
				PlCar:SetGamePositionOnGround(CVector(4609.427, 280.077, 2162.831))
				PlCar:SetRotation(Quaternion(0.001, 0.157, 0.000, -0.988))
			end

			for i=1,4 do
			    local veh1=getObj("Formula"..i)
			    if veh1 then
					veh1:Remove()
			    end
			end

			CompleteQuest("GonkaUralSpec")

			trigger:Deactivate()
		</script>
	</trigger>

	-- Madmans invasion --

	<trigger	Name="Madman_invasion_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("PlayerTP", 0)

			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("madmaninvasion_cam01", CINEMATIC_NO_AIM, nil, 13, 0,0)
			Fly("madmaninvasion_cam01_1", CINEMATIC_NO_AIM, nil, 5, 0,0)
			Fly("madmaninvasion_cam02", CINEMATIC_NO_AIM, nil, 5, 0,0)
			Fly("madmaninvasion_cam03", CINEMATIC_NO_AIM, nil, 5, 0,0)
			Fly("madmaninvasion_cam04", CINEMATIC_NO_AIM, nil, 5, 0,0)
			Fly("madmaninvasion_cam05", CINEMATIC_NO_AIM, nil, 6, 0,0)
			Fly("madmaninvasion_cam06", CINEMATIC_NO_AIM, nil, 25, 0,1)

			StartCinematic()

			PlayCustomMusic("Passage04")

			AddCinematicMessage( 152, 3 )

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(7655.588, 301.031, 3563.426))
				PVeh:SetRotation(Quaternion(0.109, -0.019, -0.154, 0.982))
				PVeh:setGodMode(1)
			end

			local MCar = CreateVehicleEx("UralMansur","MansurCar",CVector(5727.807, 250.116, 7176.776), 1090)
			if MCar then
				MCar:SetSkin(1)
				MCar:SetRotation(Quaternion(-0.000, 0.939, -0.000, 0.343))
			end

			local CCar = CreateVehicleEx("BelazShot1","AivenCar",CVector(5749.218, 251.050, 7186.484), 1095)
			if CCar then
				CCar:SetSkin(1)
				CCar:SetRotation(Quaternion(-0.003, -0.996, 0.002, 0.091))
			end

			local Alf = getObj("AivenCarZRS_vehicle_0")
			if Alf then
				Alf:Remove()
			end

			MadmanCutsceneSpawn()

			TActivate("Madman_invasion_cam01_1")
			TActivate("Madman_invasion_cam02")
			TActivate("Madman_invasion_cam03")
			TActivate("Madman_invasion_cam04")
			TActivate("Madman_invasion_cam05")
			TActivate("Madman_invasion_cam06")
			TActivate("Madman_invasion_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam01_1" active="0">
		<event flypath="madmaninvasion_cam01_1" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 153, 0.25 )

			MadmanCutsceneNeftegradSpawn()

			SetTolerance(1060, 1062, RS_NEUTRAL)	 

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam02" active="0">
		<event flypath="madmaninvasion_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(6609.482, 271.095, 4019.137))
				PVeh:SetRotation(Quaternion(-0.000, -0.689, -0.000, 0.725))
			end

			SetTolerance(1060, 1062, RS_ENEMY)	 

			AddCinematicMessage( 154, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam03" active="0">
		<event flypath="madmaninvasion_cam03" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(6578.675, 249.913, 5319.239))
				PVeh:SetRotation(Quaternion(0.000, -0.926, 0.000, 0.378))
			end

			MadmanCutsceneNeftegradRemove()

			MadmanCutsceneKefSpawn()

			SetTolerance(1025, 1062, RS_ENEMY)

			AddCinematicMessage( 155, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam04" active="0">
		<event flypath="madmaninvasion_cam04" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(5397.795, 246.086, 5968.970))
				PVeh:SetRotation(Quaternion(0.001, -0.231, -0.000, -0.973))
			end

			MadmanCutsceneKefRemove()

			MadmanCutsceneAlihamSpawn()

			AddCinematicMessage( 156, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam05" active="0">
		<event flypath="madmaninvasion_cam05" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 157, 0.25 )

			MadmanCutsceneAlihamRemove()

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(5750.906, 250.112, 7154.888))
				PVeh:SetRotation(Quaternion(-0.000, -0.689, -0.000, 0.725))
				PVeh:setGodMode(0)
				SetVar("PlayerTP", 1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Madman_invasion_cam06" active="0">
		<event flypath="madmaninvasion_cam06" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage( 158, 0.25 )
			AddCinematicMessage( 159, 0.25 )
			AddCinematicMessage( 160, 0.25 )
			AddCinematicMessage( 161, 0.25 )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Madman_invasion_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			CompleteQuest("GoToMansurandAivenJr_quest")
			TakeQuest("RepelMadmanInvasion_quest")
			TakeQuest("RepelMadmanInvasionAliham_quest")

			if GetVar("PlayerTP").AsInt == 0 then
				local PVeh = GetPlayerVehicle()
				if PVeh then
					PVeh:SetGamePositionOnGround(CVector(5750.906, 250.112, 7154.888))
					PVeh:SetRotation(Quaternion(-0.000, -0.689, -0.000, 0.725))
					PVeh:setGodMode(0)
				end

				SetCameraBehindPlayerVehicle()
			end

			SpawnMessageBox("8909")

			local b = SpawnMessageBox("8910")
			if b == 1 then
				TActivate("PlayerLeaveAndActiveTimer")
				TActivate("MadmanInvasionAutoSave")
			end

			SpawnBotsAliham()
			SpawnBotsKef()

			TActivate("ConnectMansur_madmaninvasion")
			TActivate("ConnectAivan_madmaninvasion")

			for i=0,3 do
				local MadmanCar = getObj("MadmanInvaders"..i)
				if MadmanCar then
					MadmanCar:Remove()
				end
			end

			local MCar = getObj("MansurCar")
			if MCar then
				MCar:Remove()
			end

			local CCar = getObj("AivenCar")
			if CCar then
				CCar:Remove()
			end

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( false ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( false ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( false ) end

			local town4 = GetEntityByName("r4_AlihamVil")
			if town4 then town4:SetOpenGateToPlayer( false ) end

			local town5 = GetEntityByName("TheOilCity")
			if town5 then town5:SetOpenGateToPlayer( false ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			PlayCustomMusic("Passage02a")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="MadmanInvasionAutoSave"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			AllowSave(false)
			AutoSave()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="PlayerLeaveAndActiveTimer"	active="0">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="InvasionActivate_loc" />
		<script>
			TActivate("RepelAliham_enter_time")
			TActivate("RepelAliham_timer")

			trigger:Deactivate()
		</script>
	</trigger>

	-- Aliham invasion --

	<trigger	Name="AlihamDefended_cs_start"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			FlyAround(6, 0, 25, 7, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TDeactivate("RepelAliham_timer")
			TDeactivate("RepelAliham_timer_120sec")
			TDeactivate("RepelAliham_timer_60sec")
			TDeactivate("RepelAliham_timer_30sec")
			TDeactivate("RepelAliham_timer_15sec")
			TDeactivate("RepelAliham_timerexpires")

			TActivate("AlihamDefended_cs_end")

			AddCinematicMessage(163, 1.5)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="AlihamDefended_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			TActivate("RepelGadad_timer")
			TActivate("RepelGadad_enter")

			GadadBotSpawn()

			CompleteQuest("RepelMadmanInvasionAliham_quest")
			TakeQuest("RepelMadmanInvasionGadad_quest")

			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelAlihamFailed_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("madmaninvasion_cam04", CINEMATIC_NO_AIM, nil, 16, 1,1)

			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TActivate("DestroyAliham")
			TActivate("RepelAlihamFailed_cs_end")

			AddCinematicMessage(162, 1.5)

			PlayCustomMusic("Death01")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelAlihamFailed_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelGadadFailed_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("DestroyGadad_cam", CINEMATIC_NO_AIM, nil, 14, 1,1)

			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TActivate("DestroyGadad")
			TActivate("RepelGadadFailed_cs_end")

			AddCinematicMessage(164, 1.5)

			PlayCustomMusic("Death02")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelGadadFailed_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="GadadDefended_cs_start"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			FlyAround(6, 0, 25, 12, PlfCoor, PlfID, 1, 1 )
			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TDeactivate("RepelGadad_timer")
			TDeactivate("RepelGadad_timer_120sec")
			TDeactivate("RepelGadad_timer_60sec")
			TDeactivate("RepelGadad_timer_30sec")
			TDeactivate("RepelGadad_timer_15sec")
			TDeactivate("RepelGadad_timerexpires")

			TActivate("GadadDefended_cs_end")

			AddCinematicMessage(165, 1.5)
			AddCinematicMessage(166, 0.25)


			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="GadadDefended_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			TActivate("RepelKef_timer")
			TActivate("RepelKef_enter")

			CompleteQuest("RepelMadmanInvasionGadad_quest")
			TakeQuest("RepelMadmanInvasionKef_quest")

			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			trigger:Deactivate()
		</script>
	</trigger>

	-- Kef invasion --

	<trigger	Name="RepelKefFailed_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("DestroyKef_cam", CINEMATIC_NO_AIM, nil, 15, 1,1)

			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TActivate("DestroyKef")
			TActivate("RepelKefFailed_cs_end")

			AddCinematicMessage(167, 1.5)

			PlayCustomMusic("Death02")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelKefFailed_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="KefDefended_cs_start"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("KefDefended_cam", CINEMATIC_NO_AIM, nil, 18, 1,0)
			Fly("KefDefended_cam02", CINEMATIC_NO_AIM, nil, 22, 0,1)

			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
				vehPlayer:SetGamePositionOnGround(CVector(6410.656, 251.064, 5035.400))
				vehPlayer:SetRotation(Quaternion(0.001, 0.199, 0.003, 0.980))
			end

			for i=0,3 do
				local dBots = getObj("KefInvasionDefend_vehicle_"..i)
				if dBots then
					dBots:Remove()
				end
			end

			local aCar = getObj("AivenCarMD_vehicle_0")
			if aCar then
				aCar:Remove()
			end

			local mCar = getObj("MansurCarMD_vehicle_0")
			if mCar then
				mCar:Remove()
			end

			local mCCar = CreateVehicleEx("UralMansur","MansurCarCS",CVector(6389.877, 251.753, 5064.563), 1090)
			if mCCar then
				mCCar:SetSkin(1)
				mCCar:SetRotation(Quaternion(0.038, -0.803, -0.029, -0.594))
			end

			local aCCar = CreateVehicleEx("BelazShot1","AivanCar",CVector(6378.719, 251.062, 5047.619), 1095)
			if aCCar then
				aCCar:SetRotation(Quaternion(-0.003, -0.590, -0.002, -0.807))
			end

			local Father = CreateVehicleEx("PlayerStartCar","FatherCar",CVector(6423.190, 251.053, 5060.235), 1025)
			if Father then
				Father:SetRotation(Quaternion(-0.001, -0.708, 0.003, 0.707))
				local Fskin = GetVar("PlayerMilkSkin").AsInt
				Father:SetSkin(Fskin)
			end

			TDeactivate("RepelKef_timer")
			TDeactivate("RepelKef_timer_120sec")
			TDeactivate("RepelKef_timer_60sec")
			TDeactivate("RepelKef_timer_30sec")
			TDeactivate("RepelKef_timer_15sec")
			TDeactivate("RepelKef_timerexpires")
			
			TActivate("KefDefended_cs_171msg")
			TActivate("KefDefended_cs_end")

			AddCinematicMessage(168, 1.5)
			AddCinematicMessage(169, 0.5)
			AddCinematicMessage(170, 0.5)

			PlayCustomMusic("IntenseDialogue03")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="KefDefended_cs_171msg" active="0">
		<event flypath="KefDefended_cam02" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			PlayCustomMusic("Passage04")

			MadmanCutsceneNeftegradSpawn()

			SetTolerance(1062, 1060, RS_ENEMY)

			TActivate("PlayerTP_KefDefended")

			AddCinematicMessage(171, 2)
			AddCinematicMessage(172, 0.5)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="PlayerTP_KefDefended" active="0">
		<event timeout="3" eventid="GE_TIME_PERIOD" />
		<script>
			SetTolerance(1062, 1060, RS_ENEMY)

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetGamePositionOnGround(CVector(6460.870, 264.200, 4215.955))
				PVeh:SetRotation(Quaternion(-0.064, 0.372, -0.261, 0.888))
				PVeh:setGodMode(1)
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="KefDefended_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			CompleteQuest("RepelMadmanInvasionKef_quest")
			TakeQuest("RepelMadmanInvasionNeftegrad_quest")

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetGamePositionOnGround(CVector(6410.656, 251.064, 5035.400))
				vehPlayer:SetRotation(Quaternion(0.001, 0.199, 0.003, 0.980))
				SetCameraBehindPlayerVehicle()
			end

			local mcar = getObj("MansurCarCS")
			if mcar then
				mcar:Remove()
			end

			local acar = getObj("AivanCar")
			if acar then
				acar:Remove()
			end

			local fcar = getObj("FatherCar")
			if fcar then
				fcar:Remove()
			end

			MadmanCutsceneNeftegradRemove()
			NeftegradBotSpawn()

			SetTolerance(1025,1100,RS_ALLY)
			SetTolerance(1025,1090,RS_ALLY)
			SetTolerance(1025,1095,RS_ALLY)

			TActivate("RepelNG_enter")
			TActivate("RepelNG_timer")
			TActivate("ConnectAiven_defendNG")
			TActivate("ConnectMansur_defendNG")
			TActivate("ConnectFather_defendNG")

			PlayCustomMusic("Battle01")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelNGFailed_cs"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("madmaninvasion_cam02", CINEMATIC_NO_AIM, nil, 17, 1,1)

			StartCinematic()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end
			
			TActivate("DestroyNG")
			TActivate("RepelNGFailed_cs_end")

			AddCinematicMessage(173, 2.5)

			PlayCustomMusic("Death02")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="RepelNGFailed_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NGDefended_cs_start" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("MadmanDefeated_cam", CINEMATIC_NO_AIM, nil, 151, 1,1)
			StartCinematic()

			local S1 = CreateVehicleEx("Cruiser01","Scient0",CVector(6403.864, 272.048, 3587.096), 1061)
			local S2 = CreateVehicleEx("Cruiser01","Scient1",CVector(6392.156, 272.053, 3600.808), 1061)

			local SC0 = GetVar("ScSkin0").AsInt
			local SC1 = GetVar("ScSkin1").AsInt

			for i=0,1 do
				local DVehs = getObj("NGDefenders_vehicle_"..i)
				if DVehs then
					DVehs:Remove()
				end
		
				local SDVehs = getObj("NGSDefenders_vehicle_"..i)
				if SDVehs then
					SDVehs:Remove()
				end

				local S = getObj("Scient"..i)
				if S then
					S:SetRotation(Quaternion(-0.003, -0.468, -0.002, -0.884))
					if i==0 then
						if 0 > SC0 then
							S:SetRandomSkin()
						else
							S:SetSkin(SC0)
						end
					else
						if 0 > SC1 then
							S:SetRandomSkin()
						else
							S:SetSkin(SC1)
						end
					end
				end
			end

			local M = CreateVehicleEx("UralMansur","MansurCarCS",CVector(6434.021, 271.331, 3596.112), 1090)
			if M then
				M:SetSkin(1)
				M:SetRotation(Quaternion(-0.012, -0.837, -0.014, 0.547))
			end

			local F = CreateVehicleEx("PlayerStartCar","Father",CVector(6430.854, 270.962, 3613.272), 1090)
			if F then
				local Fskin = GetVar("PlayerMilkSkin").AsInt
				F:SetSkin(Fskin)
				F:SetRotation(Quaternion(-0.009, -0.851, -0.035, 0.525))
			end

			local A = CreateVehicleEx("BelazShot1","Aiven",CVector(6422.613, 270.421, 3623.675), 1095)
			if A then
				A:SetRotation(Quaternion(-0.015, -0.963, -0.051, 0.264))
			end
		
			local fCar = getObj("FatherCarNG_vehicle_0")
			if fCar then
				fCar:Remove()
			end
		
			local MCar = getObj("MansurCarNG_vehicle_0")
			if MCar then
				MCar:Remove()
			end
		
			local ACar = getObj("AivenCarNGD_vehicle_0")
			if ACar then
				ACar:Remove()
			end

			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetCustomControlEnabled( true )
				PVeh:SetCustomLinearVelocity( 0 )
				PVeh:SetThrottle( 0 )
				PVeh:SetCustomControlEnabled( false )
				PVeh:SetGamePositionOnGround(CVector(6441.761, 271.352, 3583.622))
				PVeh:SetRotation(Quaternion(-0.002, -0.678, -0.012, 0.735))
			end

			PlayCustomMusic("QuietDialogue03")

			TActivate("NGDefended_cs_fade")
			TActivate("NGDefended_cs_end")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="NGDefended_cs_fade"	active="0">
		<event eventid="GE_CINEMATIC_ENTER_FADE_IN" ObjName="Player1" />
		<script>
			AddCinematicMessage( 174, 0.25 )
			AddCinematicMessage( 175, 0.25 )
			AddCinematicMessage( 176, 0.25 )
			AddCinematicMessage( 177, 0.25 )
			AddCinematicMessage( 178, 0.25 )
			AddCinematicMessage( 179, 0.25 )
			AddCinematicMessage( 180, 0.25 )
			AddCinematicMessage( 181, 0.25 )
			AddCinematicMessage( 182, 0.25 )
			AddCinematicMessage( 183, 0.25 )
			AddCinematicMessage( 184, 0.25 )
			AddCinematicMessage( 185, 0.25 )
			AddCinematicMessage( 186, 0.25 )
			AddCinematicMessage( 187, 0.25 )
			AddCinematicMessage( 188, 0.25 )
			AddCinematicMessage( 189, 0.25 )
			AddCinematicMessage( 190, 0.25 )
			AddCinematicMessage( 191, 0.25 )
			AddCinematicMessage( 192, 0.25 )
			AddCinematicMessage( 193, 0.25 )
		
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="NGDefended_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			CompleteQuest("RepelMadmanInvasionNeftegrad_quest")
			CompleteQuest("RepelMadmanInvasion_quest")

			TakeQuest("BackToKef_afterinvasion_quest")

			RestoreAllToleranceStatus()

			SetCameraBehindPlayerVehicle()

			StopPlayingCustomMusic()

			for i=0,1 do
				local DVehs = getObj("Scient"..i)
				if DVehs then
					DVehs:Remove()
				end
			end

			local M = getObj("MansurCarCS")
			if M then
				M:Remove()
			end

			local F = getObj("Father")
			if F then
				F:Remove()
			end

			local A = getObj("Aiven")
			if A then
				A:Remove()
			end

			AddHistory("tcoh_afterinvasion")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			TActivate("AC_AI_tr")
			TActivate("MC_AI_tr")
			TActivate("FC_AI_tr")

			AllowSave(true)

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( true ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( true ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( true ) end

			local town4 = GetEntityByName("r4_AlihamVil")
			if town4 then town4:SetOpenGateToPlayer( true ) end

			local town5 = GetEntityByName("TheOilCity")
			if town5 then town5:SetOpenGateToPlayer( true ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="FewMinutesLater_tr"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("FML_cam", CINEMATIC_NO_AIM, nil, 5, 0,1)
			StartCinematic()

			PlayCustomMusic("Bio07unloop")
			AddCinematicMessage(8805, 0.1)

			TActivate("FewMinutesLater_tr_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="FewMinutesLater_tr_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StartConversation("dad_end1")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Ending1_tr"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)			

			local Plf = GetPlayerVehicle()
			
			if Plf then
				Plf:SetGamePositionOnGround(getPos("End1_loc"))			
				Plf:SetRotation(Quaternion(0.002, 0.138, 0.008, -0.990))
				Plf:SetCustomLinearVelocity(14)			
				Plf:LimitMaxSpeed(14)				
				Plf:SetExternalPathByName("end1_path")
			end

			local PlfID = GetPlayerVehicleId()
			RuleConsole("cinematic_spring_coeff 0.99")		

			FlyLinked("ENEMYLISADEAD_cam01", PlfID, 128, 0, 0, PlfID)			
			Fly("e1_cam2", CINEMATIC_NO_AIM, nil, 9.5, 0, 0)
			Fly("e1_cam3", CINEMATIC_NO_AIM, nil, 5.5, 0, 0)	
			Fly("e1_cam4", CINEMATIC_NO_AIM, nil, 5.5, 0, 1)		
			StartCinematic()			

			PlayCustomMusic("Techno01")			

			AddCinematicMessage(8806, 0.1)
			AddCinematicMessage(194, 1)			
			AddCinematicMessage(195, 0.25)			
			AddCinematicMessage(196, 0.25)			
			AddCinematicMessage(197, 0.25)			
			AddCinematicMessage(198, 0.25)			
			AddCinematicMessage(199, 0.25)			
			AddCinematicMessage(200, 0.25)			
			AddCinematicMessage(201, 0.25)			
			AddCinematicMessage(202, 0.25)			
			AddCinematicMessage(203, 0.25)			
			AddCinematicMessage(204, 0.25)			
			AddCinematicMessage(205, 0.25)			
			AddCinematicMessage(206, 0.25)			
			AddCinematicMessage(207, 0.25)			
			AddCinematicMessage(208, 0.25)			
			AddCinematicMessage(209, 0.25)			
			AddCinematicMessage(210, 0.25)			
			AddCinematicMessage(211, 0.25)

			TActivate("Ending1_tr_babah")	
			TActivate("Ending1_tr_shake")	
			TActivate("Ending1_tr_shake2")		
			TActivate("Ending1_tr_end")			

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Ending1_tr_babah"	active="0">
		<event flypath="e1_cam2" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			RuleConsole("g_postEffect wNuclearExp")

			PlayCustomMusic("passage04end1")

			local Plf = GetPlayerVehicle()
			if Plf then
				Plf:SetExternalPathByName("end1_path")
				Plf:PlaceToEndOfPath("end1_path")
				Plf:UnlimitMaxSpeed()
			end

			AddCinematicMessage(212, 0.25)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Ending1_tr_shake"	active="0">
		<event flypath="e1_cam3" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			--Kef--
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(6040.391, 269.481, 5058.382), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(6010.234, 256.368, 5208.539), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(6113.816, 259.479, 5147.182), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(6132.553, 263.956, 5146.330), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(6365.704, 287.330, 5275.518), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(6376.649, 250.186, 5167.866), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(6423.297, 258.430, 5139.449), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(6383.232, 307.414, 5173.023), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(6182.589, 254.318, 4956.778), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			--Aliham--
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(4873.668, 252.000, 5706.798), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(4942.770, 252.000, 5666.800), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(4938.091, 252.000, 5627.208), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(4941.399, 252.908, 5589.747), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(4921.849, 252.175, 5573.271), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(4841.961, 252.555, 5604.830), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(4841.510, 250.771, 5633.459), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(4873.031, 258.205, 5686.577), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			--Gadad--
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(5569.596, 297.915, 7235.454), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(5609.851, 251.982, 7225.595), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(5647.563, 308.542, 7262.631), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(5716.747, 289.305, 7232.723), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(5634.143, 252.582, 6897.362), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(5500.640, 256.628, 6856.295), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(5714.388, 259.870, 6854.787), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(5575.749, 254.131, 6798.950), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(5504.091, 250.264, 6741.547), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			--Neftegrad--
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(6561.852, 274.561, 3528.563), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(6352.657, 273.680, 3630.539), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(6560.305, 269.342, 3492.771), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(6524.299, 268.956, 3451.540), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(6583.313, 275.362, 3490.637), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(6499.228, 275.485, 3461.671), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(6462.195, 269.990, 3516.732), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(6606.588, 269.910, 3626.271), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(6648.509, 275.134, 3578.252), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			AddCinematicMessage(213, 0.25)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="Ending1_tr_shake2"	active="0">
		<event flypath="e1_cam4" eventid="GE_START_CINEMATIC_FLY" ObjName="Player1" />
		<script>
			AddCinematicMessage(214, 0.25)

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="Ending1_tr_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			TActivate("BadEnd_tr")

			trigger:Deactivate()
		</script>
	</trigger>

	-- End and titles --

	<trigger	Name="BadEnd_tr"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			Fly("t1_cam", CINEMATIC_NO_AIM, nil, 70, 0,1)
			StartCinematic()

			PlayCustomMusic("Bio08")

			CreateNewDummyObject("end_plane", "ending", -1, -1, CVector(2671.585, 350.571, 515.247), Quaternion(0.000, 0.998, -0.005, -0.065), 0)

			AddCinematicMessage(77770, 0)
			AddCinematicMessage(77772, 0.5)
			AddCinematicMessage(77773, 0.5)
			AddCinematicMessage(777731, 0.5)
			AddCinematicMessage(77774, 0.5)
			AddCinematicMessage(77775, 0.5)
			AddCinematicMessage(77776, 0.5)
			AddCinematicMessage(77770, 0)
			AddCinematicMessage(5968, 0.2)
			AddCinematicMessage(5969, 0.2)
			AddCinematicMessage(5970, 0.2)
			AddCinematicMessage(5971, 0.2)

			TActivate("BadEnd_tr_77772")
			TActivate("BadEnd_tr_77773")
			TActivate("BadEnd_tr_77774")
			TActivate("BadEnd_tr_titles")
			TActivate("BadEnd_tr_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEnd_tr_77772" active="0">
		<event msgid="77772" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			local P = getObj("ending")
			if P then
				P:SetSkin(0)
			end

			RuleConsole("g_postEffect BWFadeIn")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEnd_tr_77773" active="0">
		<event msgid="77773" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			local P = getObj("ending")
			if P then
				P:SetSkin(1)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEnd_tr_77774" active="0">
		<event msgid="77774" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
			local P = getObj("ending")
			if P then
				P:SetSkin(2)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="BadEnd_tr_titles" active="0">
		<event msgid="5968" eventid="GE_START_CINEMATIC_MSG" ObjName="Player1" />
		<script>
        	PlayCustomMusic("EndGame")

			RuleConsole("g_postEffect BWFadeOut")

			RuleConsole("snd_2dVolume 0")
			RuleConsole("snd_3dVolume 0")
			RuleConsole("mus_Volume 70")

        	trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="BadEnd_tr_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			local b = SpawnMessageBox("8911")
			if b == 1 then
				ShowDeathMenu()
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="historyadd_aftersharaftalk"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			AddHistory("tcoh_aftersharaftalk")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="AfterCoastFight_cs_start"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			SaveAllToleranceStatus(RS_NEUTRAL)

			local AID = getObj("AivanJr_vehicle_0"):GetId()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomControlEnabled( true )
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetCustomControlEnabled( false )
			end

			Fly("AfterCoastFight_cam", CINEMATIC_AIM_TO_ID, AID, 5, 1, 1)
			StartCinematic()

			PlayCustomMusic("IntenseDialogue01")

			TActivate("AfterCoastFight_cs_end")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="AfterCoastFight_cs_end"	active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()

			StartConversation("Chujezemets")

			trigger:Deactivate()
		</script>
	</trigger>
</triggers>
