<?xml version="1.0" encoding="windows-1251" standalone="yes" ?>
<triggers>
	<trigger	Name="GlobalVar"	active="1">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SetVar("MaxWalkHuman",31)
			SetVar("MaxLap",1)
			SetVar("BuhPoint",0)
			SetVar("CountCar",4)
			SetVar("PlayerCarNameRace",0)
			SetVar("Gonka",0)
			SetVar("Strahovka",0)

			-- TCoH VAR's --

			SetVar("AddedStartMoney", 0)
			SetVar("StartBattle", 1)
			SetVar("BuharaSaveTalk", 0)
			SetVar("ChujezemetsTalk", 0)
			SetVar("MansurTalk", 0)
			SetVar("BettingCoeff", 2)
			SetVar("EndRaceSpeed", 10)
			SetVar("DriveToDD", 0)
			
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="TimersCheck"	active="1">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			if QuestStatus("RepelMadmanInvasionAliham_quest")==Q_TAKEN then
				local AlihamTimer = GetVar("AlihamTimerIsOn").AsInt

				if AlihamTimer > 0 then
					TActivate("RepelAliham_timer")
				end
			end
			
		    trigger:Deactivate()
		</script>
	</trigger>
<!--
**************************************************************************************************
** Сюжет
**************************************************************************************************
-->
	<trigger	Name="trStartMap"	active="0">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if QuestStatus("r4m1_FindNative")==Q_CANBEGIVEN then
			   TActivate("cinPriezdFirst")
			   trigger:Deactivate()
			end
		</script>
	</trigger>

    <trigger	Name="trSubDelete"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			local submar = getObj("SubmR4M1")
			if submar then
				submar:Remove()
			end
			
			TActivate("trMoveR2ToR2M2")
			
			trigger:Deactivate()
	
		</script>
	</trigger>

	<trigger	Name="trCreateMolokovoz"	active="0">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="TheKef" />
		<script>
			local veh=CreateVehicleEx("Molokovoz01","PlayerMolokovoz",CVector(getPos("MolokovozSpawn_loc")))
			if veh then
				veh:SetRotation(Quaternion(-0.007, -0.769, -0.008, 0.639))
				veh:SetRandomSkin()
				veh:AttachTrailer("MolokovozTrailer")

			   local nametr = veh:GetName().."_Trailer"
			   local trailer = getObj(nametr)
			   if trailer then
				   trailer:SetSkin(veh:GetSkin())
				   local tr = getObj("trTrailerDie")
				   if tr then
				      tr:AddEvent("GE_OBJECT_DIE",nametr)
			    	  TActivate("trTrailerDie")
	   			   end
			   end

				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
			   		vehPlayer:SetNameFromScript("OilPlayerCar")
				end

			   local tr = getObj("trPlayerEndExitTown")
			   if tr then
			      tr:AddEvent("GE_TARGET_REACHED", "OilPlayerCar")
		    	  TActivate("trPlayerEndExitTown")
 			   end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trPlayerEndExitTown"	active="0">
<!--			<event	timeout="1"			eventid="GE_TIME_PERIOD" /> -->
		<!--event eventid="GE_TARGET_REACHED" ObjName="PlayerVehicle_0_0"/-->
		<script>
--			println("trPlayerEndExitTown")
			TActivate("cinMolokovozFirst")
			trigger:Deactivate()
		</script>
	</trigger>


	
	<trigger	Name="trReturnPlCar"	active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="OilVehicleChange_loc" />
		<script>
--			println("run trPlayerEndExitTown")
			TActivate("cinPlCarReturnFirst")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trSetTolNeutral"	active="0">
		<event	timeout="0"			eventid="GE_TIME_PERIOD" />
		<script>
		    SetTolerance(1100, 1023,RS_ALLY)
		    SetTolerance(1042, 1023,RS_ALLY)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trSetTolEnemy"	active="0">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearKef_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearGadad_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearAliham_loc" />
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="NearZuhel_loc" />
		<script>
		    SetTolerance(1100, 1023,RS_ALLY)
		    SetTolerance(1042, 1023,RS_ALLY)

--			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trOiler"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Oil_loc" />
		<script>
			local amount=trigger:GetTriggeredObjectAmount()
--			local i=0
--			while getObj(trigger:GetTriggeredObjectID(i)) do
			for i=0,amount - 1 do
				local veh = getObj(trigger:GetTriggeredObjectID(i))
				if veh:GetName()=="PlayerMolokovoz" then
					if QuestStatus("r4m1_KNO_GotoOiler")==Q_TAKEN then
						TActivate("cinOilFirst")
						CompleteQuest("r4m1_KNO_GotoOiler")
					end
					do break end
				end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trTrailerDie"	active="0">
		<script>
--			PlayCustomMusic("Death01")
			SpawnMessageBox( "8902" )
			ShowDeathMenu()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trBuhArmy"	active="0">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
			local attm = CreateTeam("BuharsAttackers",1025,CVector(getPos("BuharAttack_loc")),{"Fighter01","Fighter01","Ural01","Cruiser01"},CVector(getPos("BAEndPoint_loc")), nil, Quaternion(-0.037, 0.992, 0.016, 0.117))
			if attm then
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(0), "kpvt01", 3, 10)
				attm:GetVehicle(1):AddItemsToRepository("add_stability_and_speed", 1)
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(2), "hunterSideGun",  3, 8+random(2))
				AddVehicleGunsWithRandomAffix( attm:GetVehicle(3), "vulcan01", 3, 10)
			end
			CompleteQuest("r4m1_FPR_MeetWithOldMan")
			SetTolerance(1100,1025, RS_ENEMY)
			SetTolerance(1026,1025, RS_ENEMY)
			TActivate("trBuharsAttackersDie")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trBuharsAttackersDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="BuharsAttackers" />
		<script>
			CompleteQuest("r4m1_RBC_DefendCountry")
			StartConversation("r4m1_BuharsLeader")
			trigger:Deactivate()
		</script>
	</trigger>



<!--
**************************************************************************************************
** Эвакуация в порт
**************************************************************************************************
-->
	<trigger	Name="trPlayerEnterToPort"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearPort_loc"/>
		<script>
			if QuestStatus("r4m1_RBC_GotoPort")==Q_TAKEN then
			   CompleteQuest("r4m1_RBC_GotoPort")
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trCreateBuharers" active="0">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
--			local bhteam = CreateTeam("Buharers",1026, CVector(getPos("BuhSpawn_loc")),{"DemoUral1","DemoMolokovoz1"})

			local veh1 = CreateVehicleEx("DemoUral1","Buharers_vehicle_0",CVector(getPos("BuhSpawn_loc")), 1026)
			if veh1 then
				veh1:SetExternalPathByName("BuharsEvac_Path1_1")
				veh1:SetCruisingSpeed(100)
				veh1:SetGamePositionOnGround(CVector(getPos("BuharaEvac0_loc")))
				veh1:SetRotation(Quaternion(-0.018, 0.833, -0.036, 0.552))
			end
			local veh2 = CreateVehicleEx("DemoMolokovoz1","Buharers_vehicle_1",CVector(getPos("BuhSpawn_loc"))+CVector(7, 0, 7), 1026)
			if veh2 then
				veh2:SetExternalPathByName("BuharsEvac_Path2_1")
				veh2:SetCruisingSpeed(100)
				veh2:SetGamePositionOnGround(CVector(getPos("BuharaEvac1_loc")))
				veh2:SetRotation(Quaternion(-0.018, 0.833, -0.036, 0.552))
			end

			SetVar("BuhCurPoint",1)
			SetVar("BuhPoint1",0)
			SetVar("BuhPoint2",0)
			SetVar("BuhPoint3",0)
			SetVar("BuhPoint4",0)
			SetVar("BuhPoint5",0)

			TActivate("trBuharsDie")
			TActivate("trBuharsEnterToPort")
			TActivate("trBuhReachPoint")

			TakeQuest("r4m1_RBC_Evacuate")

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			trigger:Deactivate() 
		</script>
	</trigger>


	<trigger	Name="trBuhReachPoint"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="Buharers_vehicle_0"/>
		<event eventid="GE_TARGET_REACHED" ObjName="Buharers_vehicle_1"/>
		<script>
--			println("trBuhReachPoint")

			local point = GetVar("BuhCurPoint").AsInt
			local stat = GetVar("BuhPoint"..point).AsInt+1

--			println("stat = "..stat.." point = "..point)

			SetVar("BuhPoint"..point,stat)
			if stat>=2 then
				point = point+1
				SetVar("BuhCurPoint",point)
	          	for i=0,1 do
					local FVehicle = getObj("Buharers_vehicle_"..i)
					if FVehicle then
						FVehicle:SetExternalPathByName("BuharsEvac_Path"..(i+1).."_"..point)
					else
--						println("Error - Point = "..point)
					end
				end
                if point>=5 then
                	TDeactivate("trActiveBuhReach")
					TDeactivate("trBuharsDie")
					TActivate("cinBuhPortFirst")
					CompleteQuest("r4m1_RBC_Evacuate")
					AddHistory( "r4_AfterAtackToBuhars" )
					AddFadingMsgId( "fm_history_got" )
				else
					TActivate("trActiveBuhReach")
                end
                trigger:Deactivate() 
			end
		</script>
	</trigger>

	<trigger Name="trActiveBuhReach" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("trBuhReachPoint")		
			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="trBuharsDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_0" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_1" />
		<script>
			FailQuest("r4m1_RBC_Evacuate")
			FailQuest("r4m1_RescueBuharsCivilian")
			SpawnMessageBox( "8901" )
			ShowDeathMenu()
			trigger:Deactivate()
		</script>
	</trigger>



-- Взрывы бочек --
	<trigger	Name="trBabah"	active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Babah_loc" />
		<script>
			local bahID = CreateNewObject{
				prototypeName = "superBlastWave",
				objName = "MyWave",
				belong = 1001
			}
			local bah = GetEntityByID(bahID)
			if bah then
				bah:SetPosition(CVector(4535.243, 248.904, 6498.239))
			end
			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="trExitToR4M2" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ExitFromMapToR4M2_loc" />
		<script>
			local P = GetPlayerVehicle()
			if P then
				P:SetThrottle( 0 )
				P:SetCustomLinearVelocity( 0 )
			end

			if QuestStatus("EvacuateBuharas_quest")==Q_COMPLETED and not (QuestStatus("GoToOracle_quest")==Q_TAKEN) then
				local b = SpawnMessageBox( "8801" )
				if b == 1 then
					PassToMap("r4m2", "FromR4M1", -1 )
				else
					TActivate("cinExit42ReturnFirst")
				end
			else
				TActivate("cinExit42ReturnFirst")
			end
 		</script>
	</trigger>

	<trigger Name="trExitToR4M0" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="ExitFromMapToR4M0_loc" />
		<script>
			local P = GetPlayerVehicle()
			if P then
				P:SetThrottle( 0 )
				P:SetCustomLinearVelocity( 0 )
			end

			if QuestStatus("BackToKef_afterinvasion_quest")==Q_COMPLETED and GetVar("DriveToDD").AsInt==1 then
				local b = SpawnMessageBox( "8801" )

				if b == 1 then
					PassToMap("r4m0", "FromR4M1", -1 )

					if QuestStatus("GoToDesertOfDeath_quest")==Q_TAKEN then
						local Alf = getObj("AivenCarGTK_vehicle_0")
						if Alf then
							Alf:Remove()
						end

						local Mlf = getObj("MansurCarBTK_vehicle_0")
						if Mlf then
							Mlf:Remove()
						end
					end
				else
					TActivate("cinExit11ReturnFirst")
				end
			elseif QuestStatus("BackToKef_afterinvasion_quest")==Q_COMPLETED and GetVar("DriveToDD").AsInt~=1 then
				local a = SpawnMessageBox( "8913" )
				if a == 1 then
					local b = SpawnMessageBox( "8801" )

					if b == 1 then
						PassToMap("r4m0", "FromR4M1", -1 )
						SetVar("DriveToDD", 1)

						if QuestStatus("GoToDesertOfDeath_quest")==Q_TAKEN then
							local Alf = getObj("AivenCarGTK_vehicle_0")
							if Alf then
								Alf:Remove()
							end

							local Mlf = getObj("MansurCarBTK_vehicle_0")
							if Mlf then
								Mlf:Remove()
							end
						end
					else
						TActivate("cinExit11ReturnFirst")
					end
				end
			else
				TActivate("cinExit11ReturnFirst")
			end
 		</script>
	</trigger>

	<trigger Name="trMoveR2ToR2M2" active="1">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="EnterToSubmarine_loc" />
		<script>
			if QuestStatus("r4m2_TalkWithScientific")==Q_COMPLETED then
				trigger:Deactivate()
			
				local Plf = GetPlayerVehicle()
				local PlfID = GetPlayerVehicleId()
				local PlfCoor = Plf:GetPosition()
				PlfCoor.y = PlfCoor.y + 25*0.74
				PlfCoor.z = PlfCoor.z + 25*0.74

				Plf:SetCustomControlEnabled( true )
				Plf:SetCustomLinearVelocity( 0 )
				Plf:SetThrottle( 0 )
				Plf:SetCustomControlEnabled( false )

				local b = SpawnMessageBox( "8801" )
				if b == 1 then

					TActivate ("cinMovePlToR2M2_begin")

				else
					SaveAllToleranceStatus(RS_NEUTRAL)

					TActivate ("StartR2M2No")

					FlyAround( 6, 0, 25, 5, PlfCoor, PlfID, 1, 1 )
					StartCinematic()
				end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="StartR2M2No"	active="0">
		<event	eventid="GE_SKIP_CINEMATIC"	ObjName="Player1" />
		<event	eventid="GE_END_CINEMATIC"	ObjName="Player1" />
		<script>
			RestoreAllToleranceStatus()
			
			SetCameraBehindPlayerVehicle()

			local vehPlayer = GetPlayerVehicle()
			if vehPlayer then
				vehPlayer:SetCustomLinearVelocity( 0 )
				vehPlayer:SetThrottle( 0 )
				vehPlayer:SetPosition( CVector(1361.777, 220.570, 3114.695))
		   		vehPlayer:SetRotation(Quaternion(0.000, -0.826, 0.000, -0.564))
		   	end

			TActivate("trMoveR2ToR2M2")

			trigger:Deactivate() 
		</script>
	</trigger>

<!--
**************************************************************************************************
** Гонки
**************************************************************************************************
-->
	<trigger	Name="trA"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
--			println("Capture car")
			if GetPlayerVehicle() then 
--				SetVar("PlayerCarNameRace",GetPlayerVehicle():GetName())
				GetPlayerVehicle():SetNameFromScript( "PlayerCarGonki" )
				SaveWeaponGroups()
			end
--			println("Name = "..GetVar("PlayerCarName").AsString)
			CapturePlayerVehicle(0, "PlayerRace")
			AddPlayerMoney(-10000)
--			if team then 
--			   team:SetDestination(CVector(getPos("MolokovozSpawn_loc")))
--			end
--			if veh then
--			   veh:SetExternalPathByName("molokovozPath1")
--			   local pl=g_Player
--	   		   g_Player:AddChild(veh)
--			end
  

--			println("Create Formula 1 vehicles")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
				local veh = CreateVehicleEx("Formula01","FormulaCar"..i,  CVector(getPos("RaceStart"..i.."_loc"))+CVector(0,1,0), 1100)
				if veh then 
				   veh:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
				   local sk=random(8)-1

				   while sk==2 do
				   	  sk=random(8)-1
				   end
--				   veh:SetSkin(sk)
				   veh:SetRandomSkin()
				   veh:SetForcedMaxTorque(1500)
				   veh:SetMaxSpeed(2000)
				   veh:SetCruisingSpeed(1500)
				end
			end
			local plcar=CreateVehicleEx("Formula01","PlayerFormula",  CVector(getPos("RaceStart8_loc"))+CVector(0,1,0), 1100)
			local pl=g_Player
			if pl and plcar then 
			   plcar:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
			   plcar:SetSkin(2)	
			   plcar:setImmortalMode(1)
			   pl:AddChild(plcar)
			end

			local explayercar = getObj("PlayerCarGonki")
			if explayercar then
				explayercar:SetGamePositionOnGround(CVector(4410.569, 281.094, 2051.014))
				explayercar:SetRotation(Quaternion(0.003, 0.571, 0.001, 0.821))
				explayercar:SetCustomControlEnabled( true )
				explayercar:SetCustomLinearVelocity( 0 )
				explayercar:SetThrottle( 0 )
				explayercar:SetCustomControlEnabled( false )
			end


			SetVar("nummsg",5)
			SetVar("PlayerPlace",8)
			SetVar("NextPoint",2)
			for j=0,7 do
				SetVar("LapCount"..j,0)
			end
--			SetVar("LapCount",1)
			SetVar("CarCurSide1","2")
			SetVar("CarCurSide2","1")
			SetVar("CarCurSide3","3")
			SetVar("CarCurSide4","2")
			SetVar("CarCurSide5","3")
			SetVar("CarCurSide6","1")
			SetVar("CarCurSide7","2")
			
			local maxlap = GetVar("MaxLap").AsInt
			for j=1,8 do
				for k=0,maxlap-1 do
					SetVar("PointCarCount"..k.."_"..j,0)
				end
			end

			TActivate("trRaceTimer")
			TActivate("trFalseStar")
			TActivate("trRaceCarDie")
			TActivate("trCheckPoints")
			TActivate("trPlayerFormulaDie")
--			TActivate("trStartRace")
			AllowSave( false )
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trRaceTimer"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
			local nummsg=GetVar("nummsg").AsInt
--			AddFadingMsgId( "fm_race_start_"..nummsg )
			AddFadingMsgByStrIdFormatted( "fm_race_start_1", nummsg)
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_1", nummsg)
			SetVar("nummsg",nummsg-1)
			if nummsg==1 then 
			   TActivate("trStartRace")
--				AddFadingMsgId( "fm_race_start_0" )			   
				trigger:Deactivate()
			end
		</script>
	</trigger>


	<trigger	Name="trStartRace"	active="0">
		<event	timeout="1"		eventid="GE_TIME_PERIOD" />
		<script>
		
--			println("trStartRace run")
			AddFadingMsgId( "fm_race_start_0" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_0" )
			TDeactivate("trFalseStar")
			TActivate("trFormulaMoving")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			    local veh1=getObj("FormulaCar"..i)
			    if veh1 then
					local let = {"L","M","R"}			    	
					local nump = GetVar("CarCurSide"..i).AsInt
				    veh1:SetExternalPathByName("Gonka_StartPath_"..let[nump])
			    end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFalseStar" active="0">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="RaceStart8_loc" />
		<script>
			AddFadingMsgId( "fm_race_start_false" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_false" )
			TDeactivate("trRaceTimer")
			TDeactivate("trStartRace")
			TActivate("trFalseStartRace")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFormulaMoving"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath01_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath02_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath03_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath04_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath05_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath06_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath07_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath08_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath09_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath10_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath11_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath12_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath13_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath14_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath15_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath16_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath17_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath18_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath19_loc" />
		<script>
--			println("~~~~~~~~~~~~~~~~~~~~~~")
			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()
--			      println("Guest Name = "..name)
--			      LOG("Guest Name = "..name)

				  if strsub(name,1,10)=="FormulaCar" then
						local locname = trigger:GetCallObjName()
						local locnum = tonumber(strsub(locname,12,13))

						local carnum=tonumber(strsub(name,11,11))
						local canmovearr = {{1,2,2},{1,2,3},{2,2,3}}

						local let = {"L","M","R"}			    	
						local nums = GetVar("CarCurSide"..carnum).AsInt

						local newnums = canmovearr[nums][random(3)]
						SetVar("CarCurSide"..carnum,newnums)
--						println("Location Name = "..locname)
--						LOG("Location Name = "..locname)

--						local nextpath = "Gonka_"..locnum.."-"..locnum+1.."_"..let[newnums]
						local nextpath = "Gonka_"..locnum.."-"..(locnum+1).."_"..let[newnums]
--						nextpath = nextpath.."_"
--						println(nextpath)
--						LOG(nextpath)
						guest:SetExternalPathByName(nextpath)
--						guest:SetDestination(CVector(getPos("FormulaPath"..locnum+1.."_loc")))
					end
			   end
			end
--			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trCheckPoints" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint1_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint2_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint3_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint4_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint5_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint6_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint7_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint8_loc" />
		<script>
--			println("!!!!!!!!!!!!")

			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()

--			      println("Guest Name = "..name)
--				  LOG("Guest Name = "..name)

				  local locname = trigger:GetCallObjName()
				  local carnum=tonumber(strsub(name,11,11))

--				  println("Location Name = "..locname)

                  if name=="PlayerFormula" then
                     carnum = 0
                  end
				  local maxcar = GetVar("CountCar").AsInt
				  local lap = GetVar("LapCount"..carnum).AsInt
				  local locnum = tonumber(strsub(locname,11,11))
				  local CurCarCounter=GetVar("PointCarCount"..lap.."_"..locnum).AsInt+1

--				  println("Curent Lap = "..lap.." locnum = "..locnum.." Counter = "..CurCarCounter.." / "..maxcar)
--				  LOG("Curent Lap = "..lap.." locnum = "..locnum.." Counter = "..CurCarCounter.." / "..maxcar)

--				  println(1)
					if name=="PlayerFormula" then
--					  println(2)
						local pointnum = GetVar("NextPoint").AsInt
-- Игрок приехал в правильный чекпоинт
						if locnum==pointnum then
--					  println(3)
							AddFadingMsgId( "fm_race_chekpoint" )
							AddImportantFadingMsgByStrIdFormatted( "fm_race_chekpoint" )

							SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
							SetVar("PlayerPlace",CurCarCounter)

--							println(GetVar("PointCarCount"..locnum).AsInt)
							if 3>=CurCarCounter then
								AddFadingMsgId( "fm_race_finish_"..CurCarCounter)
								AddImportantFadingMsgId( "fm_race_finish_"..CurCarCounter)
							else
--								AddFadingMsgId( "fm_race_finish_less")
								AddFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
								AddImportantFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
							end
							SetVar("NextPoint",pointnum+1)
--						end
--					  println(4)
							if pointnum==8 then
								SetVar("NextPoint",1)
							elseif pointnum==1 then
								if lap == 0 then
									AddFadingMsgId( "fm_race_firslap" )
									AddImportantFadingMsgId( "fm_race_firslap" )
							    elseif lap >= 1 then
									AddFadingMsgId( "fm_race_finish" )
									AddImportantFadingMsgByStrIdFormatted( "fm_race_finish" )
--									println(1)
									guest:SetCustomControlEnabled(1)
--									println(2)
									guest:SetExternalPathByName("Gonka_Finish_8")
--									println(3)
--									println("RACE STOP. Place = "..CurCarCounter)
									TActivate("trFinishRace")
							    end
--							    println("Car Num = "..carnum.." NextLap = "..(lap+1))
--							    LOG("Car Num = "..carnum.." NextLap = "..(lap+1))
							    SetVar("LapCount"..carnum,lap+1)
							end
						else
							AddFadingMsgId( "fm_race_chekpoint_notright" )
							AddImportantFadingMsgByStrIdFormatted( "fm_race_chekpoint_notright" )
						end
					elseif strsub(name,1,10)=="FormulaCar" then
--						println("==== +1")
						if locnum==1 then
							SetVar("LapCount"..carnum,lap+1)
						end
						if lap>=1 and locnum==1 then
							guest:SetExternalPathByName("Gonka_Finish_"..carnum)
						end
						SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
					end
--					if CurCarCounter>=maxcar then
--						SetVar("PointCarCount"..laplocnum,0)
--						println("CheckPoint "..locnum.." reset")
--					end
			   end
			end
		</script>
	</trigger>

	<trigger	Name="trRaceCarDie"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar1" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar2" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar3" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar4" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar5" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar6" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar7" />
		<script>
--			println("Some Car Die")
			local CarCount=GetVar("CountCar").AsInt
			AddFadingMsgId( "fm_race_somedie" )
			SetVar("CountCar",CarCount-1)
			if CarCount==1 then
			   trigger:Deactivate()
			end
		</script>
	</trigger>


	<trigger	Name="trFinishRace"	active="0">
<!--		<event	timeout="1"		eventid="GE_TIME_PERIOD" />-->
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
		    local place = GetVar("PlayerPlace").AsInt
		    if place==1 then
    			AddPlayerMoney(40000)
		    elseif place==1 then
    			AddPlayerMoney(20000)
		    elseif place==1 then
    			AddPlayerMoney(10000)
			elseif place>4 then
				place=4
			end

--			local plcar = GetPlayerVehicle()
			local healthmax=GetPlayerMaxHealth()
			local healthcur=GetPlayerHealth()
			local cenahp = 5000/healthmax
			local ostcena=healthcur*cenahp
--			println("Ostatok = "..ostcena)
			AddPlayerMoney(ostcena)

			CreateNewDummyObject( "brick_debris1", "CamTochka", -1, -1, CVector(4176.459, 284.317, 2168.970), Quaternion(0, 0, 0, 0), 0)
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()

			FlyLinked("linkedcam", CTochID, 5, 0, 1, PlfID)
			StartCinematic()

		    AddCinematicMessage( place+3, 0.5 )
		    TActivate("trRemoveAllRace")
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trPlayerFormulaDie"	active="0">	
		<event eventid="GE_VEHICLE_WITHOUT_HEALTH" ObjName="PlayerFormula" />
		<script>

			local Plf = getObj("PlayerFormula")
			if Plf~=nil then 
				local PlfID = Plf:GetId()
				local PlfCoor = Plf:GetPosition()
				PlfCoor.y = PlfCoor.y + 25*0.74
				PlfCoor.z = PlfCoor.z + 25*0.74

				Plf:SetCustomControlEnabled(true)
				Plf:SetCustomLinearVelocity(0)
				Plf:SetThrottle(0)
				Plf:SetCustomControlEnabled(false)

				FlyAround(6, 0, 6, 6, PlfCoor, PlfID, 1, 1 )
--				Plf:setImmortalMode(0)
--				Plf:AddModifier("hp","- 1000")
				StartCinematic()
			    AddCinematicMessage( 8, 0.5 )
			end
		    TActivate("trRemoveAllRace")
    		SetVar("PlayerPlace",0)
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFalseStartRace"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			Plf:SetCustomControlEnabled(true)
			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)
			Plf:SetCustomControlEnabled(false)

			FlyAround(6, 0, 6, 6, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			SetVar("PlayerPlace",0)
		    AddCinematicMessage( 9, 0.5 )
		    TActivate("trRemoveAllRace")
		    trigger:Deactivate()
		</script>
	</trigger>



	<trigger	Name="trRemoveAllRace"	active="0">
<!--		<event	timeout="1"		eventid="GE_TIME_PERIOD" /> -->
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />

		<script>
			CapturePlayerVehicle(0, "PlayerFormula")
			SetVar("Gonka",0)
			AllowSave( true )
			TDeactivate("trRaceCarDie")
			TDeactivate("trCheckPoints")
			TDeactivate("trFormulaMoving")
			TDeactivate("trPlayerFormulaDie")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			   local veh=getObj("FormulaCar"..i)
			   if veh then 
			      veh:Remove()
			   end
			end

			local veh=getObj("PlayerFormula")
			if veh then 
			     veh:Remove()
			end

			local CToch = GetEntityByName("CamTochka")
			if CToch then CToch:Remove() end

--			local plcarname=GetVar("PlayerCarNameRace").AsString
--			println("Name = "..plcarname)
			local pl=g_Player
			local plcar=getObj("PlayerCarGonki")
			if pl and plcar then
--				println("GiveCar")
				pl:AddChild(plcar)
				RestoreWeaponGroups()
			end

			GetPlayerVehicle():setGodMode(0)
			GetPlayerVehicle():SetCustomControlEnabled(0)
			StopPlayingCustomMusic()
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trStartHumans"	active="1">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
			-- local maxhum = GetVar("MaxWalkHuman").AsInt
			-- if maxhum then
			-- 	for i=1,maxhum do
			-- 		local tr = getObj("trHumanDie")
			-- 		if tr then
			-- 		   tr:AddEvent("GE_OBJECT_DIE", "WalkerHuman"..i )
			-- 		end
			-- 	end
			-- end
			TActivate("trCreateHumans")
        	trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="trCreateHumans"	active="0">
		<event	timeout="10"			eventid="GE_TIME_PERIOD" />
		<script>
			local maxhum = GetVar("MaxWalkHuman").AsInt
			if maxhum then
				for i=1,maxhum do
					local hum = getObj("WalkerHuman"..i)
					if not hum then      	
						local hummodlist = {"Human","Human2","Human3"}
		    		  	local newhum = CreateHuman( hummodlist[random(3)], 1001, CVector(getPos("SpawnHuman"..i.."_loc")), "WalkerHuman"..i, "Human"..i.."_Path")
		    		  	if newhum then
		    		  	   newhum:SetSkin(random(2))
		    		  	end
			        end
				end
				--TActivate("trHumanDie")
			end
        	trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trHumanDie"	active="0">
		<script>
			TActivate("trCreateHumans")
        	trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="trRunDownEngineer"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="NearEngineer_loc" />
		<script>
--			local plveh=CreateVehicleEx("Ural01","PlayerCar",CVector(4390.808, 300, 5880.886), 1100)
--			g_Player:AddChild(plveh)
			TActivate("cinEngineerFirst")

        	trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="trEngineerGoAway"	active="0">
		<event	timeout="1"			eventid="GE_TIME_PERIOD" />
		<script>
			local team=getObj("EngCar")
			if team then
--			   team:SetDestination()    
			   team:SetExternalPathByName("engineerGoAwayPath")
			   team:setImmortalMode(1)
			   TActivate("trEngineerFree")
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trEngineerGoToBarrel"	active="0">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("trEngineerMustDie")
			TActivate("cinEngineerMustDieFirst")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trEngineerMustDie"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="EngCar"/>
		<script>
		    local team=getObj("EngCar")
			if team then
				team:AddModifier("hp","= -1000")
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trEngineerFree"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="EngCar"/>
		<script>
		    local team=getObj("EngCar")
			if team then
				team:Remove()
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="cinEngineer_MusicStop" active="0">
	<event        timeout="20"        eventid="GE_TIME_PERIOD" />
		<script>
			StopPlayingCustomMusic()
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trPlaceSecret"	active="1">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			local i=1
			local gunlist = {"hornet01","specter01","pkt01","kord01","storm01","fagot01","maxim01","vector01","vulcan01","kpvt01","rapier01","flag01","rainmetal01","elephant01","odin01","omega01","bumblebee01","hammer01","hunterSideGun","mrakSideGun","big_swingfire01","cyclops01","octopus01","hailSideGun","hurricane01","rocketLauncher","zeusSideGun","marsSideGun"}
			local len = getn(gunlist)

			while getObj("SecretPlace"..i.."_loc")~=nil do
--				println(i)
				CreateBoxWithAffixGun(CVector(getPos("SecretPlace"..i.."_loc")), gunlist[exrandom(len)], random(0, 2))
				i = i + 1
			end

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="trPlaceCar"	active="0">
		<event	timeout="0.001"			eventid="GE_TIME_PERIOD" />
		<script>
			GetPlayerVehicle():SetThrottle( 0 )
			GetPlayerVehicle():SetCustomLinearVelocity( 0 )

			setPos(GetPlayerVehicle(),CVector(getPos("PlayerCarOnRacePos_loc")))
			setRot(GetPlayerVehicle(),Quaternion(0.001, 0.571, 0.000, 0.821))
			trigger:Deactivate()
		</script>
	</trigger>

    <!-- The Chronicle of Hamza  -->

	<trigger	Name="HamzaStartGame_tr"	active="1">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
			g_ObjCont:SetGameTime( 20, 0, 2, 10, 2234 )

			SetRadarUpgrade(1)

			ShowMap()

			SaveAllToleranceStatus(RS_NEUTRAL)

			SetTolerance(1023, 1025, RS_ALLY)

			SetCameraBehindPlayerVehicle()

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			TActivate("HamzaStartRolikBegin")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="FirstDebyli_Die" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="StartDebyli" />
		<script>
            TDeactivate("MansurCar_Die")
			TDeactivate("Player_Die")

		    TActivate("AfterBezumBoiRolik_Start")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurCar_Die" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="MansurTachka" />
		<script>
            TDeactivate("FirstDebyli_Die")

		    SpawnMessageBox("8906")

			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Player_Die" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Player1" />
		<script>
		    TDeactivate("FirstDebyli_Die")
			TDeactivate("MansurCar_Die")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="CreateDadCar"	active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
			local DCar = CreateVehicleEx("UralDadHamza","DadUral",  CVector(6408.515, 251.050, 5117.623), 1100)

			if DCar then
				DCar:SetRotation(Quaternion(0.001, 0.787, -0.003, -0.616))
			    DCar:SetSkin(7)
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="CarNameMilk"	active="0">
		<event	timeout="0.01"			eventid="GE_TIME_PERIOD" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
				PVeh:SetNameFromScript("MyCar")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="NewOldCar_tr" active="0">
		<event	timeout="0.1"			eventid="GE_TIME_PERIOD" />
		<script>
			CapturePlayerVehicle(0, "PlayerOldCar")

			local plcar=GetEntityByName("DadUral")
			local pl=g_Player

			if pl and plcar then
			   pl:AddChild(plcar)
			end

			local explayercar = getObj("MyCar")
			if explayercar then
				explayercar:Remove()
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="StartUralRace" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("CarNameToUral")
			TActivate("trA1")

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( false ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( false ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( false ) end

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger Name="CarNameToUral" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local PVeh = GetPlayerVehicle()
			if PVeh then
			    PVeh:SetNameFromScript("MyCar")
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="CreateMansurRepairer" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)

            local M = CreateVehicleEx("UralMansur","MansurCarCS",CVector(5626.962, 251.059, 7543.884), 1090)
			if M then
				M:SetSkin(1)
				M:SetRotation(Quaternion(0.001, 0.006, 0.003, 1.000))
			end

			CreateNewDummyObject( "SergoFull", "MansurHuman", -1, -1, CVector(5628.931, 249.059, 7544.242), Quaternion(-0.4966, 0.5098, 0.5032, 0.4902), 0)

			local pseudomansur = getObj("MansurHuman")
			if pseudomansur then
				pseudomansur:SetNodeAction(AT_RESERVED1)
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="MansurFinded_cs_launch"	active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="FindMansurQuest_loc" />
		<script>
			TActivate("MansurFinded")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectMansur" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)

			local M = getObj("MansurCarCS")
			if M then
				M:Remove()
			end

			local Mh = getObj("MansurHuman")
			if Mh then
				Mh:Remove()
			end

            TeamCreate("MansurCar", 1090, CVector(5626.962, 251.059, 7543.884), {"UralMansur"}, nil, nil, Quaternion(0.001, 0.006, 0.003, 1.000))

			local vehMansur = getObj("MansurCar_vehicle_0")
			if vehMansur then
				vehMansur:SetSkin(1)
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="trA1"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			if GetPlayerVehicle() then
				SaveWeaponGroups()
			end

			CapturePlayerVehicle(0, "PlayerRace")

            local veh = CreateVehicleEx("UralRace00","FormulaCar1",  CVector(getPos("RaceStart1_loc"))+CVector(0,1,0), 1100)
				if veh then 
				   veh:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
				   veh:SetRandomSkin()
				   veh:SetForcedMaxTorque(500)
				   veh:SetMaxSpeed(83.4)
				   veh:SetCruisingSpeed(65)
				end

			local veh2 = CreateVehicleEx("UralRace01","FormulaCar2",  CVector(getPos("RaceStart2_loc"))+CVector(0,1,0), 1100)
				if veh2 then 
				   veh2:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
				   veh2:SetRandomSkin()
				   veh2:SetForcedMaxTorque(500)
				   veh2:SetMaxSpeed(83.4)
				   veh2:SetCruisingSpeed(65)
				end

			local veh3 = CreateVehicleEx("UralMansurRace","FormulaCar3",  CVector(getPos("RaceStart3_loc"))+CVector(0,1,0), 1100)
				if veh3 then 
				   veh3:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
				   veh3:SetSkin(1)
				   veh3:SetForcedMaxTorque(500)
				   veh3:SetMaxSpeed(83.4)
				   veh3:SetCruisingSpeed(65)
				end


			local plcar=CreateVehicleEx("UralDadHamza_Race","PlayerFormula",  CVector(getPos("RaceStart4_loc"))+CVector(0,1,0), 1100)
			local pl=g_Player
			if pl and plcar then 
			   plcar:SetRotation(Quaternion(0.000, -0.999, 0.000, 0.050))
			   plcar:SetSkin(7)	
			   plcar:setImmortalMode(1)
			   plcar:SetMaxTorque(690)
			   plcar:SetMaxSpeed(83.4)
			   pl:AddChild(plcar)
			end

			local explayercar = getObj("MyCar")
			if explayercar then
				explayercar:SetGamePositionOnGround(CVector(7089.932, 321.672, 1223.257))
				explayercar:SetRotation(Quaternion(0.001, 0.418, 0.000, -0.908))
				explayercar:SetCustomControlEnabled( true )
				explayercar:SetCustomLinearVelocity( 0 )
				explayercar:SetThrottle( 0 )
				explayercar:SetCustomControlEnabled( false )
			end

		    if getObj("MansurControllerR4M1") then
		        getObj("MansurControllerR4M1"):Remove()
		    end

		    local ManVehicle = getObj("MansurCar_vehicle_0")
			if ManVehicle then
			    ManVehicle:Remove()
			end

			SetVar("nummsg",5)
			SetVar("PlayerPlace",8)
			SetVar("NextPoint",2)

			for j=0,7 do
				SetVar("LapCount"..j,0)
			end

			SetVar("CarCurSide1","2")
			SetVar("CarCurSide2","1")
			SetVar("CarCurSide3","3")
			SetVar("CarCurSide4","2")
			SetVar("CarCurSide5","3")
			SetVar("CarCurSide6","1")
			SetVar("CarCurSide7","2")

			
			local maxlap = GetVar("MaxLap").AsInt

			for j=1,8 do
				SetVar("PointCarCount".."0".."_"..j,0)
			end

			TActivate("RaceStart_cs")
			TActivate("trFalseStar1")
			TActivate("trRaceCarDie1")
			TActivate("trCheckPoints1")
			TActivate("trPlayerFormulaDie1")
			AllowSave( false )

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trRaceTimer1"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("trStartRace1")

			trigger:Deactivate()
		</script>
	</trigger>


	<trigger	Name="trStartRace1"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_race_start_0" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_0" )
			TDeactivate("trFalseStar1")
			TActivate("trFormulaMoving1")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			    local veh1=getObj("FormulaCar"..i)
			    if veh1 then
					local let = {"L","M","R"}			    	
					local nump = GetVar("CarCurSide"..i).AsInt
				    veh1:SetExternalPathByName("Gonka_StartPath_"..let[nump])
			    end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFalseStar1" active="0">
		<event	eventid="GE_OBJECT_LEAVES_LOCATION"	ObjName="RaceStart8_loc" />
		<script>
			AddFadingMsgId( "fm_race_start_false" )
			AddImportantFadingMsgByStrIdFormatted( "fm_race_start_false" )
			TDeactivate("trRaceTimer1")
			TDeactivate("trStartRace1")
			TActivate("trFalseStartRace1")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFormulaMoving1"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath01_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath02_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath03_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath04_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath05_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath06_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath07_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath08_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath09_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath10_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath11_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath12_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath13_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath14_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath15_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath16_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath17_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath18_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="FormulaPath19_loc" />
		<script>
			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()

				  if strsub(name,1,10)=="FormulaCar" then
						local locname = trigger:GetCallObjName()
						local locnum = tonumber(strsub(locname,12,13))

						local carnum=tonumber(strsub(name,11,11))
						local canmovearr = {{1,2,2},{1,2,3},{2,2,3}}

						local let = {"L","M","R"}			    	
						local nums = GetVar("CarCurSide"..carnum).AsInt

						local newnums = canmovearr[nums][random(3)]
						SetVar("CarCurSide"..carnum,newnums)

						local nextpath = "Gonka_"..locnum.."-"..(locnum+1).."_"..let[newnums]
						guest:SetExternalPathByName(nextpath)
					end
			   end
			end
		</script>
	</trigger>

	<trigger	Name="trCheckPoints1" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint1_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint2_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint3_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint4_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint5_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint6_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint7_loc" />
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="CheckPoint8_loc" />
		<script>

			local amount = trigger:GetTriggeredObjectAmount()
			for i=0, amount-1 do
			   local guestID = trigger:GetTriggeredObjectID(i)
			   local guest = getObj(guestID)
			   if guest then
			   	  local name = guest:GetName()

				  local locname = trigger:GetCallObjName()
				  local carnum=tonumber(strsub(name,11,11))

                  if name=="PlayerFormula" then
                     carnum = 0
                  end
				  local maxcar = GetVar("CountCar").AsInt
				  local lap = GetVar("LapCount"..carnum).AsInt
				  local locnum = tonumber(strsub(locname,11,11))
				  local CurCarCounter=GetVar("PointCarCount"..lap.."_"..locnum).AsInt+1


				if name=="PlayerFormula" then

						local pointnum = GetVar("NextPoint").AsInt
						if locnum==pointnum then
							AddFadingMsgId( "fm_race_chekpoint" )
							AddImportantFadingMsgByStrIdFormatted( "fm_race_chekpoint" )

							SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
							SetVar("PlayerPlace",CurCarCounter)

							if 3>=CurCarCounter then
								AddFadingMsgId( "fm_race_finish_"..CurCarCounter)
								AddImportantFadingMsgId( "fm_race_finish_"..CurCarCounter)
							else
								AddFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
								AddImportantFadingMsgByStrIdFormatted( "fm_race_finish_less", CurCarCounter, maxcar)
							end
							SetVar("NextPoint",pointnum+1)

							if pointnum==8 then
								SetVar("NextPoint",1)
							elseif pointnum==1 then
									AddFadingMsgId( "fm_race_finish" )
									AddImportantFadingMsgByStrIdFormatted( "fm_race_finish" )
									guest:SetCustomControlEnabled(1)
									guest:SetExternalPathByName("Gonka_Finish_8")
									TActivate("trFinishRace1")
							    SetVar("LapCount"..carnum,lap+1)
							end
						else
							AddFadingMsgId( "fm_race_chekpoint_notright" )
							AddImportantFadingMsgByStrIdFormatted( "fm_race_chekpoint_notright" )
						end
					elseif strsub(name,1,10)=="FormulaCar" then
						if locnum==1 then
							SetVar("LapCount"..carnum,lap+1)
						end
						if lap>=1 and locnum==1 then
							guest:SetExternalPathByName("Gonka_Finish_"..carnum)
						end
						SetVar("PointCarCount"..lap.."_"..locnum,CurCarCounter)
					end
			   end
			end
		</script>
	</trigger>

	<trigger	Name="trRaceCarDie1"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar1" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar2" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="FormulaCar3" />
		<script>
			local CarCount=GetVar("CountCar").AsInt
			AddFadingMsgId( "fm_race_somedie" )
			SetVar("CountCar",CarCount-1)
			if CarCount==1 then
			   trigger:Deactivate()
			end
		</script>
	</trigger>


	<trigger	Name="trFinishRace1"	active="0">
		<event	timeout="0.01"		eventid="GE_TIME_PERIOD" />
		<script>
		    local place = GetVar("PlayerPlace").AsInt
		    if place==1 then
    			AddPlayerMoney(20000)
		    elseif place==2 then
    			AddPlayerMoney(10000)
		    elseif place==3 then
    			AddPlayerMoney(5000)
			elseif place>4 then
				place=4
			end

			CreateNewDummyObject( "brick_debris1", "CamTochka", -1, -1, CVector(4189.459, 288.317, 2168.970), Quaternion(0, 0, 0, 0), 0)
			local CToch = GetEntityByName("CamTochka")
			local CTochID = CToch:GetId()
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()

			GetPlayerVehicle():setGodMode(1)

			FlyLinked("linkedcam", CTochID, 5, 0, 1, PlfID)
			StartCinematic()

		    AddCinematicMessage( place+3, 0.5 )

			TActivate("trFinishRace1_End")
		    TActivate("trRemoveAllRaceFinish")
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="trFinishRace1_End" active="0">
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<script>
			GetPlayerVehicle():setGodMode(0)
			
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trPlayerFormulaDie1"	active="0">	
		<event eventid="GE_VEHICLE_WITHOUT_HEALTH" ObjName="PlayerFormula" />
		<script>
			local Plf = GetPlayerVehicle()
			if Plf~=nil then 
				local PlfID = Plf:GetId()
				local PlfCoor = Plf:GetPosition()
				PlfCoor.y = PlfCoor.y + 25*0.74
				PlfCoor.z = PlfCoor.z + 25*0.74

				Plf:SetCustomControlEnabled(true)
				Plf:SetCustomLinearVelocity(0)
				Plf:SetThrottle(0)
				Plf:SetCustomControlEnabled(false)

				FlyAround(6, 0, 6, 6, PlfCoor, PlfID, 1, 1 )
				StartCinematic()
			    AddCinematicMessage( 8, 0.5 )
			end
		    TActivate("trRemoveAllRace1")
    		SetVar("PlayerPlace",0)
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trFalseStartRace1"	active="0">
		<event	timeout="0.1"		eventid="GE_TIME_PERIOD" />
		<script>
			local Plf = GetPlayerVehicle()
			local PlfID = GetPlayerVehicleId()
			local PlfCoor = Plf:GetPosition()
			PlfCoor.y = PlfCoor.y + 25*0.74
			PlfCoor.z = PlfCoor.z + 25*0.74

			Plf:SetCustomControlEnabled(true)
			Plf:SetCustomLinearVelocity(0)
			Plf:SetThrottle(0)
			Plf:SetCustomControlEnabled(false)

			FlyAround(6, 0, 6, 6, PlfCoor, PlfID, 1, 1 )
			StartCinematic()
			SetVar("PlayerPlace",0)
		    AddCinematicMessage( 9, 0.5 )
		    TActivate("trRemoveAllRace1")
		    trigger:Deactivate()
		</script>
	</trigger>



	<trigger	Name="trRemoveAllRace1"	active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			CapturePlayerVehicle(0, "PlayerFormula")
			AllowSave( true )
			TDeactivate("trRaceCarDie1")
			TDeactivate("trCheckPoints1")
			TDeactivate("trFormulaMoving1")
			TDeactivate("trPlayerFormulaDie1")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			   local veh=getObj("FormulaCar"..i)
			   if veh then 
			      veh:Remove()
			   end
			end

			local veh=getObj("PlayerFormula")
			if veh then 
			     veh:Remove()
			end

			local CToch = GetEntityByName("CamTochka")
			if CToch then CToch:Remove() end

			local pl=g_Player
			local PlCar=getObj("MyCar")
			if pl and PlCar then
				pl:AddChild(PlCar)
				PlCar:setGodMode(0)
			    PlCar:SetCustomControlEnabled(0)
				PlCar:SetGamePositionOnGround(CVector(4609.427, 280.077, 2162.831))
				PlCar:SetRotation(Quaternion(0.001, 0.157, 0.000, -0.988))
				PlCar:setImmortalMode(0)
				RestoreWeaponGroups()
			end

			local town1 = GetEntityByName("TheKef")
			if town1 then town1:SetOpenGateToPlayer( true ) end

			local town2 = GetEntityByName("TheGadad")
			if town2 then town2:SetOpenGateToPlayer( true ) end

			local town3 = GetEntityByName("TheKazif")
			if town3 then town3:SetOpenGateToPlayer( true ) end

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",1) end

			StopPlayingCustomMusic()
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trRemoveAllRaceFinish"	active="0">
		<event eventid="GE_SKIP_CINEMATIC" ObjName="Player1" />
		<event eventid="GE_END_CINEMATIC" ObjName="Player1" />
		<script>
			CapturePlayerVehicle(0, "PlayerFormula")
			AllowSave( true )
			TDeactivate("trRaceCarDie1")
			TDeactivate("trCheckPoints1")
			TDeactivate("trFormulaMoving1")
			TDeactivate("trPlayerFormulaDie1")
			local maxcar = GetVar("CountCar").AsInt
			for i=1,maxcar-1 do
			   local veh=getObj("FormulaCar"..i)
			   if veh then 
			      veh:Remove()
			   end
			end

			local veh=getObj("PlayerFormula")
			if veh then 
			     veh:Remove()
			end

			local CToch = GetEntityByName("CamTochka")
			if CToch then CToch:Remove() end

			local pl=g_Player
			local PlCar=getObj("MyCar")
			if pl and PlCar then
				pl:AddChild(PlCar)
				PlCar:setGodMode(0)
			    PlCar:SetCustomControlEnabled(0)
				PlCar:SetGamePositionOnGround(CVector(4609.427, 280.077, 2162.831))
				PlCar:SetRotation(Quaternion(0.001, 0.157, 0.000, -0.988))
				PlCar:setImmortalMode(0)
				RestoreWeaponGroups()
			end

			local ManCar = CreateVehicleEx("UralMansur","MansurCar",CVector(4615.387, 280.066, 2194.772), 1090)
			if ManCar then
			    ManCar:SetRotation(Quaternion(0.000, 0.993, 0.001, -0.118))
				ManCar:SetSkin(1)
			end

			TActivate("AfterRaceRolik_begin")

			StopPlayingCustomMusic()
		    trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectMansur_AfterRace" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)

            TeamCreate("MansurCarAR", 1090, CVector(4615.387, 280.066, 2194.772), {"UralMansur"}, nil, nil, Quaternion(0.000, 0.993, 0.001, -0.118))

			local vehMansur = getObj("MansurCarAR_vehicle_0")
			if vehMansur then
				vehMansur:SetSkin(1)
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerAfterRaceR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="RaceSpecStart"	active="0">
		<event	timeout="0.3"		eventid="GE_TIME_PERIOD" />
		<script>
			local maxcar = GetVar("CountCar").AsInt
			for i=1,4 do
			    local veh1=getObj("Formula"..i)
			    if veh1 then
					local let = {"L","M","R"}		    	
					local nump = GetVar("CarCurSide"..i).AsInt
				    veh1:SetExternalPathByName("Gonka_StartPath_"..let[nump])
			    end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AlfaHaraAllyforBattle" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
            TDeactivate("trSetTolNeutral")
			TDeactivate("trSetTolEnemy")

			SetTolerance(1100, 1023,RS_ALLY)
		    SetTolerance(1100, 1025,RS_ALLY)
			SetTolerance(1090, 1023,RS_ALLY)
		    SetTolerance(1090, 1025,RS_ALLY)
			SetTolerance(1091, 1023,RS_ALLY)
		    SetTolerance(1091, 1025,RS_ALLY)
			SetTolerance(1092, 1023,RS_ALLY)
		    SetTolerance(1092, 1025,RS_ALLY)

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="AfterGadadDefendRolik_Activate" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="GadadDebyli" />
		<script>
            TActivate("AfterGadadDefendRolik_Start")
			TDeactivate("MansurCar_DieOnGadadDefend")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="MansurCar_DieOnGadadDefend" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="MansurCarAR_vehicle_0" />
		<script>
            TDeactivate("AfterGadadDefendRolik_Activate")

		    SpawnMessageBox("8906")

			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="MansurSeeRob_activate" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="MansurSeeRob_loc" />
		<script>
		TActivate("MansurSeeRob_start")

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="TheThiefHasBeenKilled" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="KillTheRob" />
		<script>
		CompleteQuest("KillTheRobfinal_quest")
		TakeQuest("BackToSharaf_quest")

        trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="DefendKef" active="0">
		<event timeout="0.5" eventid="GE_TIME_PERIOD" />
		<script>
			CreateTheKefAttackers()

			CreateTeam("SharafCar",1025,CVector(6367.207, 249.990, 5101.260),{"BelazShot"},CVector(6367.207, 249.990, 5101.260), nil)

			SetTolerance(1025, 1024, RS_ENEMY)

			local Shv = getObj("SharafCar_vehicle_0")

			if Shv then
			    Shv:SetRotation(Quaternion(0.001, 0.779, 0.001, -0.628))
			end
			
			TActivate("KefSurvive")
			TActivate("SharafDied")

			PlayCustomMusic("Battle01")

			trigger:Deactivate() 
		</script>
	</trigger>


	<trigger Name="SharafDied" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="SharafCar" />
		<script>
			SpawnMessageBox("115")

			ShowDeathMenu()

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="KefSurvive" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="BanditsTeam" />
		<script>
			StartConversation("Kef_Sharaf")

			TDeactivate("SharafDied")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="StopBattleMusic" active="0">
		<event timeout="0.0" eventid="GE_TIME_PERIOD" />
		<script>
		    StopPlayingCustomMusic()

            trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RemoveSharaf" active="0">
		<event timeout="0.0" eventid="GE_TIME_PERIOD" />
		<script>
			local SCar = getObj("SharafCar_vehicle_0")
			if SCar then
				SCar:Remove()
			end

            trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="GoToBuhara_tr" active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Buhara_loc" />
		<script>
		    StartConversation("r4m1_BuharsLeader")

            trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="OilQuestCarTake_tr"	active="0">
		<event	eventid="GE_LEAVE_TOWN"	ObjName="TheKef" />
		<script>
			local veh=CreateVehicleEx("Molokovoz01","PlayerMolokovoz",CVector(getPos("MolokovozSpawn_loc")))
			if veh then
				veh:SetRotation(Quaternion(-0.007, -0.769, -0.008, 0.639))
				veh:SetRandomSkin()
				veh:AttachTrailer("MolokovozTrailer")

			   local nametr = veh:GetName().."_Trailer"
			   local trailer = getObj(nametr)
			   if trailer then
				   trailer:SetSkin(veh:GetSkin())
				   local tr = getObj("trTrailerDie")
				   if tr then
				      tr:AddEvent("GE_OBJECT_DIE",nametr)
			    	  TActivate("trTrailerDie")
	   			   end
			   end

				local vehPlayer = GetPlayerVehicle()
				if vehPlayer then
			   		vehPlayer:SetNameFromScript("OilHamzaCar")
				end

			   local tr = getObj("trHamzaEndExitTown")
			   if tr then
			      tr:AddEvent("GE_TARGET_REACHED", "OilHamzaCar")
		    	  TActivate("trHamzaEndExitTown")
 			   end
			end
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="trHamzaEndExitTown"	active="0">
		<script>
			TActivate("cinHamzaOilQuest")
			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectMansuronHamzasCar" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)

            TeamCreate("MansurHamzaCar", 1090, CVector(6907.314, 302.515, 5295.529), {"MirotvorecDefender"}, nil, nil, Quaternion(0.009, 0.988, 0.009, 0.155))

			local vehMansur = getObj("MansurHamzaCar_vehicle_0")
			if vehMansur then
				vehMansur:SetRandomSkin()
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerHamzaCarR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="trHamzaOiler"	active="0">
		<event	eventid="GE_OBJECT_ENTERS_LOCATION"	ObjName="Oil_loc" />
		<script>
			local amount=trigger:GetTriggeredObjectAmount()
			for i=0,amount - 1 do
				local veh = getObj(trigger:GetTriggeredObjectID(i))
				if veh:GetName()=="PlayerMolokovoz" then
					if QuestStatus("TakeOilKef_GoToOiler_quest")==Q_TAKEN then
						TActivate("HamzaReachOil_cs")
						CompleteQuest("TakeOilKef_GoToOiler_quest")
						TakeQuest("TakeOilKef_BackToKef_quest")
					end
					do break end
				end
			end

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="Kef_Sell_Add" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            local KefWorkshop = GetEntityByName("Kef_Workshop")
			local VehiclesRepo = KefWorkshop:GetRepositoryByTypename("Vehicles")
			local CabinBasketRepo = KefWorkshop:GetRepositoryByTypename("CabinsAndBaskets")
			
			if VehiclesRepo then
				VehiclesRepo:AddItems("UralForSale", 1)
				VehiclesRepo:AddItems("BelazForSale", 1)
				VehiclesRepo:AddItems("MirotvorecForSale", 1)
			end

			if CabinBasketRepo then
				CabinBasketRepo:AddItems("bugCargo02", 1)
				CabinBasketRepo:AddItems("bugCargo03", 1)
				CabinBasketRepo:AddItems("molokovozCargo02", 1)
				CabinBasketRepo:AddItems("molokovozCargo03", 1)
				CabinBasketRepo:AddItems("uralCargo01", 1)
				CabinBasketRepo:AddItems("uralCargo02", 1)
				CabinBasketRepo:AddItems("uralCargo03", 1)
				CabinBasketRepo:AddItems("uralCargo04", 1)
				CabinBasketRepo:AddItems("belazCargo01", 1)
				CabinBasketRepo:AddItems("belazCargo02", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo04", 1)
				CabinBasketRepo:AddItems("belazCargo02", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo04", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo01", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo02", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo03", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo05", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo03", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo05", 1)
				CabinBasketRepo:AddItems("bugCab02", 1)
				CabinBasketRepo:AddItems("bugCab03", 1)
				CabinBasketRepo:AddItems("molokovozCab02", 1)
				CabinBasketRepo:AddItems("molokovozCab03", 1)
				CabinBasketRepo:AddItems("belazCab01", 1)
				CabinBasketRepo:AddItems("belazCab02", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab04", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab04", 1)
				CabinBasketRepo:AddItems("mirotvorecCab01", 1)
				CabinBasketRepo:AddItems("mirotvorecCab02", 1)
				CabinBasketRepo:AddItems("mirotvorecCab03", 1)
				CabinBasketRepo:AddItems("mirotvorecCab05", 1)
				CabinBasketRepo:AddItems("mirotvorecCab02", 1)
				CabinBasketRepo:AddItems("mirotvorecCab03", 1)
				CabinBasketRepo:AddItems("mirotvorecCab05", 1)
				CabinBasketRepo:AddItems("uralCab02", 1)
				CabinBasketRepo:AddItems("uralCab03", 1)
				CabinBasketRepo:AddItems("uralCab04", 1)
				CabinBasketRepo:AddItems("uralCab05", 1)
				CabinBasketRepo:AddItems("uralCab05", 1)
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="Gadad_Sell_Add" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            local GadadWorkshop = GetEntityByName("Gadad_Workshop")
			local VehiclesRepo = GadadWorkshop:GetRepositoryByTypename("Vehicles")
			local CabinBasketRepo = GadadWorkshop:GetRepositoryByTypename("CabinsAndBaskets")
			
			if VehiclesRepo then
				VehiclesRepo:AddItems("UralForSale", 1)
				VehiclesRepo:AddItems("BelazForSale", 1)
				VehiclesRepo:AddItems("MirotvorecForSale", 1)
			end

			if CabinBasketRepo then
				CabinBasketRepo:AddItems("bugCargo02", 1)
				CabinBasketRepo:AddItems("bugCargo03", 1)
				CabinBasketRepo:AddItems("molokovozCargo02", 1)
				CabinBasketRepo:AddItems("molokovozCargo03", 1)
				CabinBasketRepo:AddItems("uralCargo01", 1)
				CabinBasketRepo:AddItems("uralCargo02", 1)
				CabinBasketRepo:AddItems("uralCargo03", 1)
				CabinBasketRepo:AddItems("uralCargo01", 1)
				CabinBasketRepo:AddItems("uralCargo02", 1)
				CabinBasketRepo:AddItems("uralCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo01", 1)
				CabinBasketRepo:AddItems("belazCargo02", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo04", 1)
				CabinBasketRepo:AddItems("belazCargo05", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo04", 1)
				CabinBasketRepo:AddItems("belazCargo05", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo01", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo02", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo03", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo04", 1)
				CabinBasketRepo:AddItems("bugCab02", 1)
				CabinBasketRepo:AddItems("bugCab03", 1)
				CabinBasketRepo:AddItems("molokovozCab02", 1)
				CabinBasketRepo:AddItems("molokovozCab03", 1)
				CabinBasketRepo:AddItems("belazCab01", 1)
				CabinBasketRepo:AddItems("belazCab02", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab04", 1)
				CabinBasketRepo:AddItems("belazCab05", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab04", 1)
				CabinBasketRepo:AddItems("belazCab05", 1)
				CabinBasketRepo:AddItems("mirotvorecCab01", 1)
				CabinBasketRepo:AddItems("mirotvorecCab02", 1)
				CabinBasketRepo:AddItems("mirotvorecCab03", 1)
				CabinBasketRepo:AddItems("mirotvorecCab04", 1)
				CabinBasketRepo:AddItems("uralCab02", 1)
				CabinBasketRepo:AddItems("uralCab03", 1)
				CabinBasketRepo:AddItems("uralCab04", 1)
				CabinBasketRepo:AddItems("mirotvorecCab04", 1)
				CabinBasketRepo:AddItems("uralCab02", 1)
				CabinBasketRepo:AddItems("uralCab03", 1)
				CabinBasketRepo:AddItems("uralCab04", 1)
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="Kazif_Sell_Add" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            local KazifWorkshop = GetEntityByName("Kazif_Workshop")
			local VehiclesRepo = KazifWorkshop:GetRepositoryByTypename("Vehicles")
			local CabinBasketRepo = KazifWorkshop:GetRepositoryByTypename("CabinsAndBaskets")
			
			if VehiclesRepo then
				VehiclesRepo:AddItems("UralForSale", 1)
				VehiclesRepo:AddItems("BelazForSale", 1)
				VehiclesRepo:AddItems("MirotvorecForSale", 1)
			end

			if CabinBasketRepo then
				CabinBasketRepo:AddItems("bugCargo02", 1)
				CabinBasketRepo:AddItems("bugCargo03", 1)
				CabinBasketRepo:AddItems("molokovozCargo02", 1)
				CabinBasketRepo:AddItems("molokovozCargo03", 1)
				CabinBasketRepo:AddItems("uralCargo01", 1)
				CabinBasketRepo:AddItems("uralCargo02", 1)
				CabinBasketRepo:AddItems("uralCargo04", 1)
				CabinBasketRepo:AddItems("belazCargo01", 1)
				CabinBasketRepo:AddItems("belazCargo02", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo05", 1)
				CabinBasketRepo:AddItems("belazCargo03", 1)
				CabinBasketRepo:AddItems("belazCargo05", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo01", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo02", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo03", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo04", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo05", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo03", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo04", 1)
				CabinBasketRepo:AddItems("mirotvorecCargo05", 1)
				CabinBasketRepo:AddItems("bugCab02", 1)
				CabinBasketRepo:AddItems("bugCab03", 1)
				CabinBasketRepo:AddItems("molokovozCab02", 1)
				CabinBasketRepo:AddItems("molokovozCab03", 1)
				CabinBasketRepo:AddItems("belazCab01", 1)
				CabinBasketRepo:AddItems("belazCab02", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab05", 1)
				CabinBasketRepo:AddItems("belazCab03", 1)
				CabinBasketRepo:AddItems("belazCab05", 1)
				CabinBasketRepo:AddItems("mirotvorecCab01", 1)
				CabinBasketRepo:AddItems("mirotvorecCab02", 1)
				CabinBasketRepo:AddItems("mirotvorecCab03", 1)
				CabinBasketRepo:AddItems("mirotvorecCab04", 1)
				CabinBasketRepo:AddItems("mirotvorecCab05", 1)
				CabinBasketRepo:AddItems("mirotvorecCab03", 1)
				CabinBasketRepo:AddItems("mirotvorecCab04", 1)
				CabinBasketRepo:AddItems("mirotvorecCab05", 1)
				CabinBasketRepo:AddItems("uralCab01", 1)
				CabinBasketRepo:AddItems("uralCab02", 1)
				CabinBasketRepo:AddItems("uralCab04", 1)
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="HamzaReturnCar"	active="0">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="OilVehicleChange_loc" />
		<script>
			TActivate("HamzaReturnCar_cs_start")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectMansur_GoToBuhara_Again" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)

            TeamCreate("MansurCarSB", 1090, CVector(5432.852, 251.100, 7027.151), {"UralMansur"}, nil, nil, Quaternion(0.002, -0.932, -0.003, -0.362))

			local vehMansur = getObj("MansurCarSB_vehicle_0")
			if vehMansur then
				vehMansur:SetSkin(1)
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerBuharaR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="AivanJrDies" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="AivanJr" />
		<script>
            SpawnMessageBox("8907")

			ShowDeathMenu()

			TDeactivate("MansurDiesOnBuharaAndJrDefend")
			TDeactivate("OneOfBuharaDies")
			TDeactivate("AttackersDies")
			TDeactivate("PlayerDiesOnBuharaAndJrDefend")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="OneOfBuharaDies" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_0" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buharers_vehicle_1" />
		<script>
            SpawnMessageBox("8908")

			ShowDeathMenu()

			TDeactivate("MansurDiesOnBuharaAndJrDefend")
			TDeactivate("AivanJrDies")
			TDeactivate("AttackersDies")
			TDeactivate("PlayerDiesOnBuharaAndJrDefend")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="MansurDiesOnBuharaAndJrDefend" active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="MansurCarSB_vehicle_0" />
		<script>
            SpawnMessageBox("8906")

			ShowDeathMenu()

			TDeactivate("OneOfBuharaDies")
			TDeactivate("AivanJrDies")
			TDeactivate("AttackersDies")
			TDeactivate("PlayerDiesOnBuharaAndJrDefend")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="PlayerDiesOnBuharaAndJrDefend" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="Player1" />
		<script>
		    TDeactivate("OneOfBuharaDies")
			TDeactivate("AivanJrDies")
			TDeactivate("AttackersDies")
			TDeactivate("MansurDiesOnBuharaAndJrDefend")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="AttackersDies" active="0">
		<event eventid="GE_OBJECT_DIE" ObjName="BuharaAttack" />
		<script>
			TActivate("AfterCoastFight_cs_start")

			SetTolerance(1100, 1026, RS_ALLY)
			SetTolerance(1100, 1095, RS_ALLY)
			SetTolerance(1090, 1026, RS_ALLY)
			SetTolerance(1090, 1095, RS_ALLY)
			SetTolerance(1095, 1026, RS_ALLY)
			SetTolerance(1100, 1025, RS_ALLY)
			SetTolerance(1026, 1025, RS_ALLY)
			SetTolerance(1090, 1025, RS_ALLY)
			SetTolerance(1095, 1025, RS_ALLY)

		    TDeactivate("OneOfBuharaDies")
			TDeactivate("AivanJrDies")
			TDeactivate("MansurDiesOnBuharaAndJrDefend")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="SetTolerance_BuharaSave"	active="0">
		<event	timeout="0"		eventid="GE_TIME_PERIOD" />
		<script>
			SetTolerance(1100,1025, RS_ENEMY)
			SetTolerance(1026,1025, RS_ENEMY)
			SetTolerance(1090,1025, RS_ENEMY)
			SetTolerance(1095,1025, RS_ENEMY)
			SetTolerance(1100, 1026, RS_ALLY)
			SetTolerance(1100, 1095, RS_ALLY)
			SetTolerance(1090, 1026, RS_ALLY)
			SetTolerance(1090, 1095, RS_ALLY)
			SetTolerance(1095, 1026, RS_ALLY)

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RemoveBuharaAndJrTeams_AfterFight" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local buhara0 = getObj("Buharers_vehicle_0")
			if buhara0 then
				buhara0:Remove()
			end

			local buhara1 = getObj("Buharers_vehicle_1")
			if buhara1 then
				buhara1:Remove()
			end

			local aivanjr = getObj("AivanJr_vehicle_0")
			if aivanjr then
				aivanjr:Remove()
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="BuharaEvacuation" active="0">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
			local veh1 = CreateVehicleEx("DemoUral1","Buhara_0",CVector(getPos("BuhSpawn_loc")), 1026)
			if veh1 then
				veh1:SetGamePositionOnGround(CVector(getPos("BuharaEvac0_loc")))
				veh1:SetExternalPathByName("BuharsEvac_Path1_1")
				veh1:SetCruisingSpeed(100)
				veh1:SetRotation(Quaternion(-0.018, 0.833, -0.036, 0.552))
				veh1:SetSkin(0)
			end
			local veh2 = CreateVehicleEx("DemoMolokovoz1","Buhara_1",CVector(getPos("BuhSpawn_loc"))+CVector(7, 0, 7), 1026)
			if veh2 then
				veh2:SetGamePositionOnGround(CVector(getPos("BuharaEvac1_loc")))
				veh2:SetExternalPathByName("BuharsEvac_Path2_1")
				veh2:SetCruisingSpeed(100)
				veh2:SetRotation(Quaternion(-0.018, 0.833, -0.036, 0.552))
				veh2:SetSkin(0)
			end

			SetVar("BuhCurPoint",1)
			SetVar("BuhPoint1",0)
			SetVar("BuhPoint2",0)
			SetVar("BuhPoint3",0)
			SetVar("BuhPoint4",0)
			SetVar("BuhPoint5",0)

			TActivate("BuharaDiesOnWayToPort")
			TActivate("ConnectAiven")
			TActivate("BuharaPoints")

			local a = GetEntityByName("StartGonka_loc")
			if a then a:SetProperty("Active",0) end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="ConnectAiven" active="0">
		<event timeout="0.1" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("AivenCarSB", 1095, CVector(getPos("AivanJrDefSpawn_loc")), {"BelazShot1"}, nil, nil, Quaternion(-0.022, 0.083, -0.023, 0.996))

			local vehAiven = getObj("AivenCarSB_vehicle_0")
			if vehAiven then
				vehAiven:SetSkin(0)
				vehAiven:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerBuharaR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="BuharaPoints"	active="0">
		<event eventid="GE_TARGET_REACHED" ObjName="Buhara_0"/>
		<event eventid="GE_TARGET_REACHED" ObjName="Buhara_1"/>
		<script>
			local point = GetVar("BuhCurPoint").AsInt
			local stat = GetVar("BuhPoint"..point).AsInt+1

			SetVar("BuhPoint"..point,stat)
			if stat>=2 then
				point = point+1
				SetVar("BuhCurPoint",point)
	          	for i=0,1 do
					local FVehicle = getObj("Buhara_"..i)
					if FVehicle then
						FVehicle:SetExternalPathByName("BuharsEvac_Path"..(i+1).."_"..point)
					else
--						println("Error - Point = "..point)
					end
				end
                if point>=5 then
                	TDeactivate("BuharaReachActive")
					TDeactivate("BuharaDiesOnWayToPort")
					TActivate("BuharaEvacuated_cs")
				else
					TActivate("BuharaReachActive")
                end
                trigger:Deactivate() 
			end
		</script>
	</trigger>

	<trigger Name="BuharaReachActive" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("BuharaPoints")

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger	Name="BuharaDiesOnWayToPort"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buhara_0" />
		<event	eventid="GE_OBJECT_DIE"		ObjName="Buhara_1" />
		<script>
			SpawnMessageBox( "8901" )

			ShowDeathMenu()

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectMansur_GoToZarmek" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)
			SetTolerance(1090, 1095, RS_ALLY)

            TeamCreate("MansurCarGTZ", 1090, CVector(getPos("BuharaEvacuated_cs_Mansur_loc")), {"UralMansur"}, nil, nil, Quaternion(0.023, -0.814, -0.019, 0.580))

			local vehMansur = getObj("MansurCarGTZ_vehicle_0")
			if vehMansur then
				vehMansur:SetSkin(1)
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerZarmekR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="ConnectAivan_GoToZarmek" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("AivenCarGTZ", 1095, CVector(getPos("BuharaEvacuated_cs_AivenJr_loc")), {"BelazShot1"}, nil, nil, Quaternion(-0.006, 0.922, 0.008, -0.387))

			local vehAiven = getObj("AivenCarGTZ_vehicle_0")
			if vehAiven then
				vehAiven:SetSkin(0)
				vehAiven:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerZarmekR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="BettingCheck" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            local BetAmount = GetVar("BettingAmount").AsInt
			local BetNumber = GetVar("BettingNumber").AsInt
			local BetCoeff = GetVar("BettingCoeff").AsInt
			local WinNumber = GetVar("WinningNumber").AsInt

			if WinNumber == BetNumber then
				println("Betting amount is: "..BetAmount)
				println("Betting number is: "..BetNumber)
				println("Winning number is: "..WinNumber)
				println("Winning amount is: "..BetAmount*BetCoeff)

				AddPlayerMoney(BetAmount * BetCoeff)
			else
				println("Betting amount is: "..BetAmount)
				println("Betting number is: "..BetNumber)
				println("Winning number is: "..WinNumber)
				println("Your bet "..BetNumber.." is lost!")
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	-- Invasion connect --

	<trigger Name="ConnectMansur_madmaninvasion" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            SetTolerance(1100, 1090, RS_ALLY)
			SetTolerance(1090, 1002, RS_ENEMY)
			SetTolerance(1090, 1062, RS_ENEMY)
			SetTolerance(1090, 1023, RS_ALLY)
			SetTolerance(1090, 1025, RS_NEUTRAL)
			SetTolerance(1090, 1060, RS_NEUTRAL)
			SetTolerance(1090, 1095, RS_ALLY)

            TeamCreate("MansurCarMD", 1090, CVector(5727.807, 250.116, 7176.776), {"UralMansur"}, nil, nil, Quaternion(-0.000, 0.939, -0.000, 0.343))

			local vehMansur = getObj("MansurCarMD_vehicle_0")
			if vehMansur then
				vehMansur:SetSkin(1)
				vehMansur:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerInvasionR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehMansur)
				end
			end

			trigger:Deactivate() 
		</script>
	</trigger>

	<trigger Name="ConnectAivan_madmaninvasion" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("AivenCarMD", 1095, CVector(5749.218, 251.050, 7186.484), {"BelazShot1"}, nil, nil, Quaternion(-0.003, -0.996, 0.002, 0.091))

			local vehAiven = getObj("AivenCarMD_vehicle_0")
			if vehAiven then
				vehAiven:SetSkin(0)
				vehAiven:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerInvasionR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	-- Aliham invasion --

	<trigger Name="RepelAliham_enter_time" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("Aliham_defender_loc")
			local pl = GetPlayerVehicle()
			local len

			if run then
				len = Dist(pl, run)
				if (650 >= len) then
					DespawnBotsSpawnFightersAliham()

					SetTolerance(1060,1100,RS_ALLY)
					SetTolerance(1060,1090,RS_ALLY)
					SetTolerance(1060,1095,RS_ALLY)
					SetTolerance(1060,1062,RS_ENEMY)
					SetTolerance(1100,1062,RS_ENEMY)
					SetTolerance(1090,1062,RS_ENEMY)
					SetTolerance(1095,1062,RS_ENEMY)

					local MCar = getObj("MansurCarMD_vehicle_0")
					if MCar then
						MCar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(10,0,0))
						MCar:SetRotation(GetPlayerVehicle():GetRotation())
					end

					local ACar = getObj("AivenCarMD_vehicle_0")
					if ACar then
						ACar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(20,0,0))
						ACar:SetRotation(GetPlayerVehicle():GetRotation())
					end

					TActivate("AlihamDefended")

					trigger:Deactivate()
				end
			end
		</script>
	</trigger>

	<trigger Name="RepelAliham_timer" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_180sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_180sec" )

			TActivate("RepelAliham_timer_120sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelAliham_timer_120sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_120sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_120sec" )

			TActivate("RepelAliham_timer_60sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelAliham_timer_60sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_60sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_60sec" )

			TActivate("RepelAliham_timer_30sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelAliham_timer_30sec" active="0">
		<event timeout="30" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_30sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_30sec" )

			TActivate("RepelAliham_timer_15sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelAliham_timer_15sec" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_15sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_15sec" )

			TActivate("RepelAliham_timerexpires")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelAliham_timerexpires" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("RepelAlihamFailed_cs")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="AlihamDefended"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="MadmanInvadersAliham" />
		<script>
			TActivate("AlihamDefended_cs_start")	

			for i=0,2 do
				local dBots = getObj("MadmanDefendAliham_vehicle_"..i)
				if dBots then
					dBots:Remove()
				end
			end	

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="DestroyAliham"	active="0">
		<event	timeout="1.5"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(4873.668, 252.000, 5706.798), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(4942.770, 252.000, 5666.800), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(4938.091, 252.000, 5627.208), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(4941.399, 252.908, 5589.747), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(4921.849, 252.175, 5573.271), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(4841.961, 252.555, 5604.830), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(4841.510, 250.771, 5633.459), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(4873.031, 258.205, 5686.577), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			trigger:Deactivate()
		</script>
	</trigger>

	-- Gadad invasion --

	<trigger	Name="RepelGadad_enter"	active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
		local run = GetEntityByName("GMadmanInvaders0")
		local pl = GetPlayerVehicle()
		local len

		if run then
			len = Dist(pl, run)
			if (650 >= len) then
				DespawnBotsSpawnFightersGadad()

				SetTolerance(1023,1100,RS_ALLY)
				SetTolerance(1023,1090,RS_ALLY)
				SetTolerance(1023,1095,RS_ALLY)
				SetTolerance(1023,1062,RS_ENEMY)
				SetTolerance(1100,1062,RS_ENEMY)
				SetTolerance(1090,1062,RS_ENEMY)
				SetTolerance(1095,1062,RS_ENEMY)

				local MCar = getObj("MansurCarMD_vehicle_0")
				if MCar then
					MCar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(10,0,0))
					MCar:SetRotation(GetPlayerVehicle():GetRotation())
				end

				local ACar = getObj("AivenCarMD_vehicle_0")
				if ACar then
					ACar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(20,0,0))
					ACar:SetRotation(GetPlayerVehicle():GetRotation())
				end

				TActivate("GadadDefended")

				trigger:Deactivate()
			end
		end
		</script>
	</trigger>

	<trigger	Name="GadadDefended"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="MadmanInvadersGadad" />
		<script>
			TActivate("GadadDefended_cs_start")	

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RepelGadad_timer" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_180sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_180sec" )

			TActivate("RepelGadad_timer_120sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelGadad_timer_120sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_120sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_120sec" )

			TActivate("RepelGadad_timer_60sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelGadad_timer_60sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_60sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_60sec" )

			TActivate("RepelGadad_timer_30sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelGadad_timer_30sec" active="0">
		<event timeout="30" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_30sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_30sec" )

			TActivate("RepelGadad_timer_15sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelGadad_timer_15sec" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_15sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_15sec" )

			TActivate("RepelGadad_timerexpires")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelGadad_timerexpires" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("RepelGadadFailed_cs")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="DestroyGadad"	active="0">
		<event	timeout="1.5"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(5569.596, 297.915, 7235.454), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(5609.851, 251.982, 7225.595), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(5647.563, 308.542, 7262.631), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(5716.747, 289.305, 7232.723), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(5634.143, 252.582, 6897.362), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(5500.640, 256.628, 6856.295), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(5714.388, 259.870, 6854.787), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(5575.749, 254.131, 6798.950), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(5504.091, 250.264, 6741.547), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			trigger:Deactivate()
		</script>
	</trigger>

	-- Kef invasion --

	<trigger	Name="RepelKef_enter"	active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
		local run = GetEntityByName("KMadmanInvaders0")
		local pl = GetPlayerVehicle()
		local len

		if run then
			len = Dist(pl, run)
			if (650 >= len) then
				DespawnBotsSpawnFightersKef()

				SetTolerance(1025,1100,RS_ALLY)
				SetTolerance(1025,1090,RS_ALLY)
				SetTolerance(1025,1095,RS_ALLY)
				SetTolerance(1025,1062,RS_ENEMY)
				SetTolerance(1100,1062,RS_ENEMY)
				SetTolerance(1090,1062,RS_ENEMY)
				SetTolerance(1095,1062,RS_ENEMY)

				local MCar = getObj("MansurCarMD_vehicle_0")
				if MCar then
					MCar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(10,0,0))
					MCar:SetRotation(GetPlayerVehicle():GetRotation())
				end

				local ACar = getObj("AivenCarMD_vehicle_0")
				if ACar then
					ACar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(20,0,0))
					ACar:SetRotation(GetPlayerVehicle():GetRotation())
				end

				TActivate("KefDefended")

				trigger:Deactivate()
			end
		end
		</script>
	</trigger>

	<trigger Name="RepelKef_timer" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_180sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_180sec" )

			TActivate("RepelKef_timer_120sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelKef_timer_120sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_120sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_120sec" )

			TActivate("RepelKef_timer_60sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelKef_timer_60sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_60sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_60sec" )

			TActivate("RepelKef_timer_30sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelKef_timer_30sec" active="0">
		<event timeout="30" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_30sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_30sec" )

			TActivate("RepelKef_timer_15sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelKef_timer_15sec" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_15sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_15sec" )

			TActivate("RepelKef_timerexpires")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelKef_timerexpires" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("RepelKefFailed_cs")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="DestroyKef"	active="0">
		<event	timeout="0.5"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(6040.391, 269.481, 5058.382), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(6010.234, 256.368, 5208.539), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(6113.816, 259.479, 5147.182), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(6132.553, 263.956, 5146.330), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(6365.704, 287.330, 5275.518), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(6376.649, 250.186, 5167.866), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(6423.297, 258.430, 5139.449), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(6383.232, 307.414, 5173.023), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(6182.589, 254.318, 4956.778), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger	Name="KefDefended"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="KefInvasionAttack" />
		<script>
			TActivate("KefDefended_cs_start")

			for i=0,3 do
				local dBots = getObj("KefInvasionDefend_vehicle_"..i)
				if dBots then
					dBots:Remove()
				end
			end	

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="ConnectAiven_defendNG" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("AivenCarNGD", 1095, CVector(6378.719, 251.062, 5047.619), {"BelazShot1"}, nil, nil, Quaternion(-0.003, -0.590, -0.002, -0.807))

			local vehAiven = getObj("AivenCarNGD_vehicle_0")
			if vehAiven then
				vehAiven:SetSkin(0)
				vehAiven:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerNeftegradR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="ConnectMansur_defendNG" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("MansurCarNG", 1090, CVector(6389.877, 251.753, 5064.563), {"UralMansur"}, nil, nil, Quaternion(0.038, -0.803, -0.029, -0.594))

			local vehM = getObj("MansurCarNG_vehicle_0")
			if vehM then
				vehM:SetSkin(1)
				vehM:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerNeftegradR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehM)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="ConnectFather_defendNG" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("FatherCarNG", 1025, CVector(6423.190, 251.053, 5060.235), {"PlayerStartCar"}, nil, nil, Quaternion(-0.001, -0.708, 0.003, 0.707))

			local vehF = getObj("FatherCarNG_vehicle_0")
			if vehF then
				local Fskin = GetVar("PlayerMilkSkin").AsInt
				vehF:SetSkin(Fskin)
				vehF:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerNeftegradR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehF)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelNG_timer" active="0">
		<event timeout="2" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_180sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_180sec" )

			TActivate("RepelNG_timer_120sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelNG_timer_120sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_120sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_120sec" )

			TActivate("RepelNG_timer_60sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelNG_timer_60sec" active="0">
		<event timeout="60" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_60sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_60sec" )

			TActivate("RepelNG_timer_30sec")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelNG_timer_30sec" active="0">
		<event timeout="30" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_30sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_30sec" )

			TActivate("RepelNG_timer_15sec")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RepelNG_timer_15sec" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			AddFadingMsgId( "fm_repel_timer_15sec" )
			AddImportantFadingMsgByStrIdFormatted( "fm_repel_timer_15sec" )

			TActivate("RepelNG_timerexpires")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="RepelNG_timerexpires" active="0">
		<event timeout="15" eventid="GE_TIME_PERIOD" />
		<script>
			TActivate("RepelNGFailed_cs")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="DestroyNG"	active="0">
		<event	timeout="2"		eventid="GE_TIME_PERIOD" />
		<script>
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE01", -1, -1, CVector(6561.852, 274.561, 3528.563), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE02", -1, -1, CVector(6352.657, 273.680, 3630.539), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE03", -1, -1, CVector(6560.305, 269.342, 3492.771), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE04", -1, -1, CVector(6524.299, 268.956, 3451.540), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE05", -1, -1, CVector(6583.313, 275.362, 3490.637), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE06", -1, -1, CVector(6499.228, 275.485, 3461.671), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE07", -1, -1, CVector(6462.195, 269.990, 3516.732), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE08", -1, -1, CVector(6606.588, 269.910, 3626.271), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))
			CreateNewSgNodeObject("ET_PS_HOUSE_MED_FIRE", "FIRE09", -1, -1, CVector(6648.509, 275.134, 3578.252), Quaternion(0.0000, 0.0000, 0.0000, 1.0000))

			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(6561.562, 282.571, 3528.091), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )
			CreateEffectInsertedInRemove( "ET_PS_VEH_EXP1_MED1", CVector(6462.195, 269.990, 3516.732), Quaternion(0.0000, 0.0000, 0.0000, 1.0000), true )

			NGRepelFailed()

			RuleConsole("snd_3dVolume 10")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="RepelNG_enter" active="0">
		<event timeout="1" eventid="GE_TIME_PERIOD" />
		<script>
			local run = GetEntityByName("NMadmanInvaders0")
			local pl = GetPlayerVehicle()
			local len

			if run then
				len = Dist(pl, run)
				if (650 >= len) then
					DespawnBotsSpawnFightersNG()

					SetTolerance(1060,1100,RS_ALLY)
					SetTolerance(1060,1090,RS_ALLY)
					SetTolerance(1060,1095,RS_ALLY)
					SetTolerance(1060,1062,RS_ENEMY)
					SetTolerance(1100,1062,RS_ENEMY)
					SetTolerance(1090,1062,RS_ENEMY)
					SetTolerance(1095,1062,RS_ENEMY)

					SetTolerance(1025,1100,RS_ALLY)
					SetTolerance(1025,1090,RS_ALLY)
					SetTolerance(1025,1095,RS_ALLY)
					SetTolerance(1025,1062,RS_ENEMY)

					SetTolerance(1061,1100,RS_ALLY)
					SetTolerance(1061,1060,RS_ALLY)
					SetTolerance(1061,1090,RS_ALLY)
					SetTolerance(1061,1095,RS_ALLY)
					SetTolerance(1061,1062,RS_ENEMY)

					local fCar = getObj("FatherCarNG_vehicle_0")
					if fCar then
						fCar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(10,0,0))
						fCar:SetRotation(GetPlayerVehicle():GetRotation())
						fCar:setGodMode(1)
					end

					local MCar = getObj("MansurCarNG_vehicle_0")
					if MCar then
						MCar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(20,0,0))
						MCar:SetRotation(GetPlayerVehicle():GetRotation())
					end

					local ACar = getObj("AivenCarNGD_vehicle_0")
					if ACar then
						ACar:SetGamePositionOnGround(getPos(GetPlayerVehicle())+CVector(30,0,0))
						ACar:SetRotation(GetPlayerVehicle():GetRotation())
					end

					TActivate("NeftegradDefended")

					trigger:Deactivate()
				end
			end
		</script>
	</trigger>

	<trigger	Name="NeftegradDefended"	active="0">
		<event	eventid="GE_OBJECT_DIE"		ObjName="NGMadmanInvaders" />
		<script>
			TActivate("NGDefended_cs_start")

			TDeactivate("RepelNG_timer")
			TDeactivate("RepelNG_timer_120sec")
			TDeactivate("RepelNG_timer_60sec")
			TDeactivate("RepelNG_timer_30sec")
			TDeactivate("RepelNG_timer_15sec")
			TDeactivate("RepelNG_timerexpires")

			trigger:Deactivate()
		</script>
	</trigger>

	<trigger Name="FC_AI_tr" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("FatherCar", 1025, CVector(6430.854, 270.962, 3613.272), {"PlayerStartCar"}, nil, nil, Quaternion(-0.009, -0.851, -0.035, 0.525))

			local vehF = getObj("FatherCar_vehicle_0")
			if vehF then
				local Fskin = GetVar("PlayerMilkSkin").AsInt
				vehF:SetSkin(Fskin)
				vehF:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerBackToKefR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehF)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="MC_AI_tr" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("MansurCarBTK", 1090, CVector(6434.021, 271.331, 3596.112), {"UralMansur"}, nil, nil, Quaternion(-0.012, -0.837, -0.014, 0.547))

			local vehM = getObj("MansurCarBTK_vehicle_0")
			if vehM then
				vehM:SetSkin(1)
				vehM:setImmortalMode(1)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "MansurControllerBackToKefR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehM)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="AC_AI_tr" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
            TeamCreate("AivenCarGTK", 1095, CVector(6422.613, 270.421, 3623.675), {"BelazShot1"}, nil, nil, Quaternion(-0.015, -0.963, -0.051, 0.264))

			local vehAiven = getObj("AivenCarGTK_vehicle_0")
			if vehAiven then
				vehAiven:setImmortalMode(1)
				vehAiven:SetSkin(0)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerBackToKefR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	-- TCoH: Go To Oracle --

	<trigger Name="MA_Rem_DD" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			local vehAiven = getObj("AivenCarDD_vehicle_0")
			if vehAiven then
				vehAiven:Remove()
			end

			local M = getObj("MansurCarDD_vehicle_0")
			if M then
				M:Remove()
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="A_C_GTO" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			TeamCreate("AivenCarGTO", 1095, CVector(5623.750, 250.032, 7175.120), {"BelazShot1"}, nil, nil, Quaternion(-0.000, -0.999, -0.001, 0.052))

			local vehAiven = getObj("AivenCarGTO_vehicle_0")
			if vehAiven then
				vehAiven:setImmortalMode(1)
				vehAiven:SetSkin(0)

				local newControllerId = CreateNewObject {
					prototypeName	= "someNPCMotionController",
					objName	= "AivenControllerGoToOracleR4M1"
				}
				
				local newController = GetEntityByID(newControllerId)
				
				if newController then
					newController:setVehicleUnderControl(vehAiven)
				end
			end

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger	Name="PassToMap_Repo_add"	active="1">
		<event eventid="GE_GAME_START" ObjName="Player1" />
		<script>
			if GL_PassToMap == true then
			   AddSaleItems()
				if QuestStatus("blocktaken_quest")==Q_TAKEN or QuestStatus("blockleaved_quest")==Q_TAKEN then
					local Alf = getObj("AivenCarDD_vehicle_0")
					if Alf then
						Alf:SetGamePositionOnGround(CVector(3167.120, 272.174, 7456.269))
						Alf:SetRotation(Quaternion(0.019, 0.846, -0.030, 0.533))
					end

					local Mlf = getObj("MansurCarDD_vehicle_0")
					if Mlf then
						Mlf:SetGamePositionOnGround(CVector(3152.506, 273.339, 7445.637))
						Mlf:SetRotation(Quaternion(0.020, 0.939, -0.017, 0.344))
					end
				end				
			   println("Map change detected! Sale items added.")
			   GL_PassToMap = false

			   GetPlayerVehicle():SetCustomControlEnabled(false)
			end
		</script>
	</trigger>

	<trigger	Name="RaceClosedMsg"	active="1">
		<event eventid="GE_OBJECT_ENTERS_LOCATION" ObjName="StartGonka_loc" />
		<script>
			SpawnMessageBox("8912")
		</script>
	</trigger>

	<trigger Name="AkilSus_tr" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			AddHistory("tcoh_akilsus")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			trigger:Deactivate()  
		</script>
	</trigger>

	<trigger Name="musibameet_addhistory" active="0">
		<event timeout="0" eventid="GE_TIME_PERIOD" />
		<script>
			AddHistory("tcoh_aftermusibameet")
			AddFadingMsgId("fm_history_got")
			AddImportantFadingMsgByStrIdFormatted("fm_history_got")

			trigger:Deactivate()  
		</script>
	</trigger>
</triggers>
